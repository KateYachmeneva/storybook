"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2688],{"./packages/superset-ui-core/src/time-format/formatters/finestTemporalGrain.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>finestTemporalGrain});var d3_time_format__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/d3-time-format/src/defaultLocale.js"),_utils_d3Time__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/superset-ui-core/src/time-format/utils/d3Time.ts"),_TimeFormatter__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/superset-ui-core/src/time-format/TimeFormatter.ts");function finestTemporalGrain(values,useLocalTime){void 0===useLocalTime&&(useLocalTime=!1);const format=useLocalTime?d3_time_format__WEBPACK_IMPORTED_MODULE_0__.i$:d3_time_format__WEBPACK_IMPORTED_MODULE_0__.g0,formatMillisecond=format("%Y-%m-%d %H:%M:%S.%L"),formatSecond=format("%Y-%m-%d %H:%M:%S"),formatMinute=format("%Y-%m-%d %H:%M"),formatHour=format("%Y-%m-%d %H:%M"),formatDay=format("%Y-%m-%d"),formatMonth=format("%Y-%m-%d"),formatYear=format("%Y"),{hasMillisecond,hasSecond,hasMinute,hasHour,isNotFirstDayOfMonth,isNotFirstMonth}=useLocalTime?_utils_d3Time__WEBPACK_IMPORTED_MODULE_1__.Z:_utils_d3Time__WEBPACK_IMPORTED_MODULE_1__.b;let formatFunc=formatYear;return values.forEach((value=>{formatFunc===formatYear&&isNotFirstMonth(value)&&(formatFunc=formatMonth),formatFunc===formatMonth&&isNotFirstDayOfMonth(value)&&(formatFunc=formatDay),formatFunc===formatDay&&hasHour(value)&&(formatFunc=formatHour),formatFunc===formatHour&&hasMinute(value)&&(formatFunc=formatMinute),formatFunc===formatMinute&&hasSecond(value)&&(formatFunc=formatSecond),formatFunc===formatSecond&&hasMillisecond(value)&&(formatFunc=formatMillisecond)})),new _TimeFormatter__WEBPACK_IMPORTED_MODULE_2__.Z({description:"Use the finest grain in an array of dates to format all dates in the array",formatFunc,id:"finest_temporal_grain",label:"Format temporal columns with the finest grain",useLocalTime})}},"./src/filters/components/Select/SelectFilterPlugin.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>PluginFilterSelect});var react=__webpack_require__("./node_modules/react/index.js"),ensureIsArray=__webpack_require__("./packages/superset-ui-core/src/utils/ensureIsArray.ts"),getColumnLabel=__webpack_require__("./packages/superset-ui-core/src/query/getColumnLabel.ts"),finestTemporalGrain=__webpack_require__("./packages/superset-ui-core/src/time-format/formatters/finestTemporalGrain.ts"),TranslatorSingleton=__webpack_require__("./packages/superset-ui-core/src/translation/TranslatorSingleton.ts"),Base=__webpack_require__("./packages/superset-ui-core/src/chart/types/Base.ts"),debounce=__webpack_require__("./node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce),immer_esm=__webpack_require__("./node_modules/immer/dist/immer.esm.mjs");var components=__webpack_require__("./src/components/index.ts"),constants=__webpack_require__("./src/constants.ts"),utils=__webpack_require__("./src/components/Select/utils.tsx"),types=__webpack_require__("./src/dashboard/types.ts"),common=__webpack_require__("./src/filters/components/common.ts"),filters_utils=__webpack_require__("./src/filters/utils.ts"),emotion_react_browser_esm=__webpack_require__("./node_modules/@emotion/react/dist/emotion-react.browser.esm.js");function reducer(draft,action){switch(action.type){case"ownState":return draft.ownState={...draft.ownState,...action.ownState},draft;case"filterState":return JSON.stringify(draft.extraFormData)!==JSON.stringify(action.extraFormData)&&(draft.extraFormData=action.extraFormData),JSON.stringify(draft.filterState)!==JSON.stringify(action.filterState)&&(draft.filterState={...draft.filterState,...action.filterState}),draft;default:return draft}}function PluginFilterSelect(props){const{coltypeMap,data,filterState,formData,height,isRefreshing,width,setDataMask,setHoveredFilter,unsetHoveredFilter,setFocusedFilter,unsetFocusedFilter,setFilterActive,appSection,showOverflow,parentRef,inputRef,filterBarOrientation}=props,{enableEmptyFilter,multiSelect,showSearch,inverseSelection,defaultToFirstItem,searchAllOptions}=formData,groupby=(0,react.useMemo)((()=>(0,ensureIsArray.Z)(formData.groupby).map(getColumnLabel.Z)),[formData.groupby]),[col]=groupby,[initialColtypeMap]=(0,react.useState)(coltypeMap),[search,setSearch]=(0,react.useState)(""),[dataMask,dispatchDataMask]=function e(r,t,o){var i=(0,react.useMemo)((function(){return(0,immer_esm.ZP)(r)}),[r]);return(0,react.useReducer)(i,t,o)}(reducer,{extraFormData:{},filterState}),datatype=coltypeMap[col],labelFormatter=(0,react.useMemo)((()=>(0,filters_utils.EG)({timeFormatter:(0,finestTemporalGrain.Z)(data.map((el=>el[col])))})),[data,col]),updateDataMask=(0,react.useCallback)((values=>{const emptyFilter=enableEmptyFilter&&!inverseSelection&&!(null!=values&&values.length),suffix=inverseSelection&&null!=values&&values.length?(0,TranslatorSingleton.t)(" (excluded)"):"";dispatchDataMask({type:"filterState",extraFormData:(0,filters_utils.vb)(col,values,emptyFilter,inverseSelection),filterState:{...filterState,label:null!=values&&values.length?`${(values||[]).map((value=>labelFormatter(value,datatype))).join(", ")}${suffix}`:void 0,value:appSection===Base.Tr.FILTER_CONFIG_MODAL&&defaultToFirstItem?void 0:values}})}),[appSection,col,datatype,defaultToFirstItem,dispatchDataMask,enableEmptyFilter,inverseSelection,JSON.stringify(filterState),labelFormatter]),isDisabled=appSection===Base.Tr.FILTER_CONFIG_MODAL&&defaultToFirstItem,onSearch=(0,react.useMemo)((()=>debounce_default()((search=>{setSearch(search),searchAllOptions&&dispatchDataMask({type:"ownState",ownState:{coltypeMap:initialColtypeMap,search}})}),constants.M$)),[dispatchDataMask,initialColtypeMap,searchAllOptions]),handleBlur=(0,react.useCallback)((()=>{unsetFocusedFilter()}),[unsetFocusedFilter]),handleChange=(0,react.useCallback)((value=>{const values=null===value?[null]:(0,ensureIsArray.Z)(value);0===values.length?updateDataMask(null):updateDataMask(values)}),[updateDataMask]),placeholderText=0===data.length?(0,TranslatorSingleton.t)("No data"):(0,TranslatorSingleton.tn)("%s option","%s options",data.length,data.length),formItemExtra=(0,react.useMemo)((()=>{if(filterState.validateMessage)return(0,emotion_react_browser_esm.tZ)(common.Am,{status:filterState.validateStatus},filterState.validateMessage)}),[filterState.validateMessage,filterState.validateStatus]),uniqueOptions=(0,react.useMemo)((()=>[...new Set([...data.map((el=>el[col]))])].map((value=>({label:labelFormatter(value,datatype),value,isNewOption:!1})))),[data,datatype,col,labelFormatter]),options=(0,react.useMemo)((()=>(!search||multiSelect||(0,utils.Gq)(search,uniqueOptions,!0)||uniqueOptions.unshift({label:search,value:search,isNewOption:!0}),uniqueOptions)),[multiSelect,search,uniqueOptions]),sortComparator=(0,react.useCallback)(((a,b)=>{const labelComparator=(0,utils.mj)("label");return formData.sortAscending?labelComparator(a,b):labelComparator(b,a)}),[formData.sortAscending]);return(0,react.useEffect)((()=>{if(defaultToFirstItem&&void 0===filterState.value){const firstItem=data[0]?groupby.map((col=>data[0][col])):null;void 0!==(null==firstItem?void 0:firstItem[0])&&updateDataMask(firstItem)}else updateDataMask(isDisabled?null:filterState.value)}),[col,isDisabled,defaultToFirstItem,enableEmptyFilter,inverseSelection,updateDataMask,data,groupby,JSON.stringify(filterState.value)]),(0,react.useEffect)((()=>{setDataMask(dataMask)}),[JSON.stringify(dataMask)]),(0,emotion_react_browser_esm.tZ)(common.un,{height,width},(0,emotion_react_browser_esm.tZ)(common.jp,{validateStatus:filterState.validateStatus,extra:formItemExtra},(0,emotion_react_browser_esm.tZ)(components.Ph,{allowClear:!0,allowNewOptions:!0,allowSelectAll:!searchAllOptions,value:filterState.value||[],disabled:isDisabled,getPopupContainer:showOverflow?()=>(null==parentRef?void 0:parentRef.current)||document.body:trigger=>(null==trigger?void 0:trigger.parentNode)||document.body,showSearch,mode:multiSelect?"multiple":"single",placeholder:placeholderText,onSearch,onBlur:handleBlur,onFocus:setFocusedFilter,onMouseEnter:setHoveredFilter,onMouseLeave:unsetHoveredFilter,onChange:handleChange,ref:inputRef,loading:isRefreshing,oneLine:filterBarOrientation===types.Bp.HORIZONTAL,invertSelection:inverseSelection,options,sortComparator,onDropdownVisibleChange:setFilterActive})))}try{SelectFilterPlugin.displayName="SelectFilterPlugin",SelectFilterPlugin.__docgenInfo={description:"",displayName:"SelectFilterPlugin",props:{height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}},width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}},orientation:{defaultValue:null,description:"",name:"orientation",required:!1,type:{name:"enum",value:[{value:'"VERTICAL"'},{value:'"HORIZONTAL"'}]}},overflow:{defaultValue:null,description:"",name:"overflow",required:!1,type:{name:"boolean"}},coltypeMap:{defaultValue:null,description:"",name:"coltypeMap",required:!0,type:{name:"Record<string, GenericDataType>"}},data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"DataRecord[]"}},behaviors:{defaultValue:null,description:"",name:"behaviors",required:!0,type:{name:"Behavior[]"}},appSection:{defaultValue:null,description:"",name:"appSection",required:!0,type:{name:"enum",value:[{value:'"EXPLORE"'},{value:'"DASHBOARD"'},{value:'"FILTER_BAR"'},{value:'"FILTER_CONFIG_MODAL"'},{value:'"EMBEDDED"'}]}},formData:{defaultValue:null,description:"",name:"formData",required:!0,type:{name:"SqlaFormData & PluginFilterStylesProps & PluginFilterSelectCustomizeProps"}},filterState:{defaultValue:null,description:"",name:"filterState",required:!0,type:{name:"FilterState"}},isRefreshing:{defaultValue:null,description:"",name:"isRefreshing",required:!0,type:{name:"boolean"}},showOverflow:{defaultValue:null,description:"",name:"showOverflow",required:!0,type:{name:"boolean"}},parentRef:{defaultValue:null,description:"",name:"parentRef",required:!1,type:{name:"RefObject<any>"}},inputRef:{defaultValue:null,description:"",name:"inputRef",required:!1,type:{name:"RefObject<any>"}},filterBarOrientation:{defaultValue:null,description:"",name:"filterBarOrientation",required:!1,type:{name:"enum",value:[{value:'"VERTICAL"'},{value:'"HORIZONTAL"'}]}},isOverflowingFilterBar:{defaultValue:null,description:"",name:"isOverflowingFilterBar",required:!1,type:{name:"boolean"}},setDataMask:{defaultValue:null,description:"",name:"setDataMask",required:!0,type:{name:"SetDataMaskHook"}},setFocusedFilter:{defaultValue:null,description:"",name:"setFocusedFilter",required:!0,type:{name:"() => void"}},unsetFocusedFilter:{defaultValue:null,description:"",name:"unsetFocusedFilter",required:!0,type:{name:"() => void"}},setHoveredFilter:{defaultValue:null,description:"",name:"setHoveredFilter",required:!0,type:{name:"() => void"}},unsetHoveredFilter:{defaultValue:null,description:"",name:"unsetHoveredFilter",required:!0,type:{name:"() => void"}},setFilterActive:{defaultValue:null,description:"",name:"setFilterActive",required:!0,type:{name:"(isActive: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/filters/components/Select/SelectFilterPlugin.tsx#SelectFilterPlugin"]={docgenInfo:SelectFilterPlugin.__docgenInfo,name:"SelectFilterPlugin",path:"src/filters/components/Select/SelectFilterPlugin.tsx#SelectFilterPlugin"})}catch(__react_docgen_typescript_loader_error){}},"./src/filters/components/common.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Am:()=>StatusMessage,jp:()=>StyledFormItem,un:()=>FilterPluginStyle});var _superset_ui_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/superset-ui-core/src/style/index.tsx"),_components_Form_FormItem__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/Form/FormItem.tsx");const FilterPluginStyle=_superset_ui_core__WEBPACK_IMPORTED_MODULE_1__.iK.div`
  min-height: ${_ref=>{let{height}=_ref;return height}}px;
  width: ${_ref2=>{let{width}=_ref2;return 0===width?"100%":`${width}px`}};
`,StyledFormItem=(0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_1__.iK)(_components_Form_FormItem__WEBPACK_IMPORTED_MODULE_0__.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,StatusMessage=_superset_ui_core__WEBPACK_IMPORTED_MODULE_1__.iK.div`
  color: ${_ref3=>{var _theme$colors$status;let{theme,status="error"}=_ref3;return null==(_theme$colors$status=theme.colors[status])?void 0:_theme$colors$status.base}};
`},"./src/filters/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EG:()=>getDataRecordFormatter,WO:()=>getRangeExtraFormData,vb:()=>getSelectExtraFormData});var _superset_ui_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/superset-ui-core/src/query/types/QueryResponse.ts"),src_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/common.js"),_explore_components_controls_FilterControl_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/explore/components/controls/FilterControl/types.ts");const getSelectExtraFormData=function(col,value,emptyFilter,inverseSelection){void 0===emptyFilter&&(emptyFilter=!1),void 0===inverseSelection&&(inverseSelection=!1);const extra={};return emptyFilter?extra.adhoc_filters=[{expressionType:_explore_components_controls_FilterControl_types__WEBPACK_IMPORTED_MODULE_1__.v.SQL,clause:_explore_components_controls_FilterControl_types__WEBPACK_IMPORTED_MODULE_1__.P.WHERE,sqlExpression:"1 = 0"}]:null!=value&&0!==value.length&&(extra.filters=[{col,op:inverseSelection?"NOT IN":"IN",val:value}]),extra},getRangeExtraFormData=(col,lower,upper)=>{const filters=[];return null!=lower&&lower!==upper&&filters.push({col,op:">=",val:lower}),null!=upper&&upper!==lower&&filters.push({col,op:"<=",val:upper}),null!=upper&&null!=lower&&upper===lower&&filters.push({col,op:"==",val:upper}),filters.length?{filters}:{}};function getDataRecordFormatter(_temp){let{timeFormatter,numberFormatter}=void 0===_temp?{}:_temp;return(value,dtype)=>{if(null==value)return src_utils_common__WEBPACK_IMPORTED_MODULE_0__.li;if("boolean"==typeof value)return value?src_utils_common__WEBPACK_IMPORTED_MODULE_0__.Tb:src_utils_common__WEBPACK_IMPORTED_MODULE_0__.jy;if(dtype===_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.Z.BOOLEAN)try{return JSON.parse(String(value).toLowerCase())?src_utils_common__WEBPACK_IMPORTED_MODULE_0__.Tb:src_utils_common__WEBPACK_IMPORTED_MODULE_0__.jy}catch{return src_utils_common__WEBPACK_IMPORTED_MODULE_0__.jy}return"string"==typeof value?value:timeFormatter&&dtype===_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.Z.TEMPORAL?timeFormatter(value):numberFormatter&&"number"==typeof value&&dtype===_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.Z.NUMERIC?numberFormatter(value):String(value)}}}}]);
//# sourceMappingURL=2688.2af7fc2b.iframe.bundle.js.map