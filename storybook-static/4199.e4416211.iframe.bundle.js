"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4199],{"./src/explore/components/controls/AnnotationLayerControl/AnnotationLayer.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>AnnotationLayerControl_AnnotationLayer});var react=__webpack_require__("./node_modules/react/index.js"),rison=__webpack_require__("./node_modules/rison/js/rison.js"),rison_default=__webpack_require__.n(rison),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),lib=__webpack_require__("./node_modules/react-color/lib/index.js"),Button=__webpack_require__("./src/components/Button/index.tsx"),style=__webpack_require__("./packages/superset-ui-core/src/style/index.tsx"),TranslatorSingleton=__webpack_require__("./packages/superset-ui-core/src/translation/TranslatorSingleton.ts"),ChartMetadataRegistrySingleton=__webpack_require__("./packages/superset-ui-core/src/chart/registries/ChartMetadataRegistrySingleton.ts"),math_expression=__webpack_require__("./packages/superset-ui-core/src/math-expression/index.ts"),validateNonEmpty=__webpack_require__("./packages/superset-ui-core/src/validator/validateNonEmpty.ts"),SupersetClient=__webpack_require__("./packages/superset-ui-core/src/connection/SupersetClient.ts"),getColumnLabel=__webpack_require__("./packages/superset-ui-core/src/query/getColumnLabel.ts"),CategoricalSchemeRegistrySingleton=__webpack_require__("./packages/superset-ui-core/src/color/CategoricalSchemeRegistrySingleton.ts"),emotion_element_99289b21_browser_esm=__webpack_require__("./node_modules/@emotion/react/dist/emotion-element-99289b21.browser.esm.js"),SelectControl=__webpack_require__("./src/explore/components/controls/SelectControl.jsx"),TextControl=__webpack_require__("./src/explore/components/controls/TextControl/index.tsx"),CheckboxControl=__webpack_require__("./src/explore/components/controls/CheckboxControl.jsx"),PopoverSection=__webpack_require__("./src/components/PopoverSection/index.tsx"),ControlHeader=__webpack_require__("./src/explore/components/ControlHeader.tsx"),EmptyState=__webpack_require__("./src/components/EmptyState/index.tsx"),constants=__webpack_require__("./src/explore/constants.ts");function extractTypes(metadata){return Object.keys(metadata).reduce(((prev,key)=>{const result=prev;return result[key]=key,result}),{})}const ANNOTATION_TYPES_METADATA={FORMULA:{value:"FORMULA",label:(0,TranslatorSingleton.t)("Formula")},EVENT:{value:"EVENT",label:(0,TranslatorSingleton.t)("Event"),supportNativeSource:!0},INTERVAL:{value:"INTERVAL",label:(0,TranslatorSingleton.t)("Interval"),supportNativeSource:!0},TIME_SERIES:{value:"TIME_SERIES",label:(0,TranslatorSingleton.t)("Time series")}},ANNOTATION_TYPES=extractTypes(ANNOTATION_TYPES_METADATA),DEFAULT_ANNOTATION_TYPE=ANNOTATION_TYPES.FORMULA,ANNOTATION_SOURCE_TYPES_METADATA={NATIVE:{value:"NATIVE",label:"Superset annotation"}},ANNOTATION_SOURCE_TYPES=extractTypes(ANNOTATION_SOURCE_TYPES_METADATA);function requiresQuery(annotationSourceType){return!!annotationSourceType}var emotion_react_browser_esm=__webpack_require__("./node_modules/@emotion/react/dist/emotion-react.browser.esm.js");const propTypes={name:prop_types_default().string,annotationType:prop_types_default().string,sourceType:prop_types_default().string,color:prop_types_default().string,opacity:prop_types_default().string,style:prop_types_default().string,width:prop_types_default().number,showMarkers:prop_types_default().bool,hideLine:prop_types_default().bool,value:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().number]),overrides:prop_types_default().object,show:prop_types_default().bool,showLabel:prop_types_default().bool,titleColumn:prop_types_default().string,descriptionColumns:prop_types_default().arrayOf(prop_types_default().string),timeColumn:prop_types_default().string,intervalEndColumn:prop_types_default().string,vizType:prop_types_default().string,error:prop_types_default().string,colorScheme:prop_types_default().string,addAnnotationLayer:prop_types_default().func,removeAnnotationLayer:prop_types_default().func,close:prop_types_default().func},defaultProps={name:"",annotationType:DEFAULT_ANNOTATION_TYPE,sourceType:"",color:"",opacity:"",style:"solid",width:1,showMarkers:!1,hideLine:!1,overrides:{},colorScheme:"d3Category10",show:!0,showLabel:!1,titleColumn:"",descriptionColumns:[],timeColumn:"",intervalEndColumn:"",addAnnotationLayer:()=>{},removeAnnotationLayer:()=>{},close:()=>{}},NotFoundContentWrapper=style.iK.div`
  && > div:first-child {
    padding-left: 0;
    padding-right: 0;
  }
`,NotFoundContent=()=>(0,emotion_react_browser_esm.tZ)(NotFoundContentWrapper,null,(0,emotion_react_browser_esm.tZ)(EmptyState.Tc,{title:(0,TranslatorSingleton.t)("No annotation layers"),description:(0,emotion_react_browser_esm.tZ)("span",null,(0,TranslatorSingleton.t)("Add an annotation layer")," ",(0,emotion_react_browser_esm.tZ)("a",{href:"/annotationlayer/list",target:"_blank",rel:"noopener noreferrer"},(0,TranslatorSingleton.t)("here")),"."),image:"empty.svg"}));var _ref5={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};class AnnotationLayer extends react.PureComponent{constructor(props){super(props);const{name,annotationType,sourceType,color,opacity,style,width,showMarkers,hideLine,value,overrides,show,showLabel,titleColumn,descriptionColumns,timeColumn,intervalEndColumn,vizType}=props;("since"in overrides||"until"in overrides)&&(overrides.time_range=null,delete overrides.since,delete overrides.until);const metadata=(0,ChartMetadataRegistrySingleton.Z)().get(vizType),supportedAnnotationTypes=(null==metadata?void 0:metadata.supportedAnnotationTypes)||[],validAnnotationType=supportedAnnotationTypes.includes(annotationType)?annotationType:supportedAnnotationTypes[0];this.state={name,annotationType:validAnnotationType,sourceType,value,overrides,show,showLabel,titleColumn,descriptionColumns,timeColumn,intervalEndColumn,color:color||"",opacity,style,width,showMarkers,hideLine,isNew:!name,isLoadingOptions:!0,valueOptions:[]},this.submitAnnotation=this.submitAnnotation.bind(this),this.deleteAnnotation=this.deleteAnnotation.bind(this),this.applyAnnotation=this.applyAnnotation.bind(this),this.fetchOptions=this.fetchOptions.bind(this),this.handleAnnotationType=this.handleAnnotationType.bind(this),this.handleAnnotationSourceType=this.handleAnnotationSourceType.bind(this),this.handleValue=this.handleValue.bind(this),this.isValidForm=this.isValidForm.bind(this)}componentDidMount(){const{annotationType,sourceType,isLoadingOptions}=this.state;this.fetchOptions(annotationType,sourceType,isLoadingOptions)}componentDidUpdate(prevProps,prevState){prevState.sourceType!==this.state.sourceType&&this.fetchOptions(this.state.annotationType,this.state.sourceType,!0)}getSupportedSourceTypes(annotationType){var _ANNOTATION_TYPES_MET;const sources=(0,ChartMetadataRegistrySingleton.Z)().entries().filter((_ref=>{let{value:chartMetadata}=_ref;return chartMetadata.canBeAnnotationType(annotationType)})).map((_ref2=>{let{key,value:chartMetadata}=_ref2;return{value:key,label:chartMetadata.name}}));return null!=(_ANNOTATION_TYPES_MET=ANNOTATION_TYPES_METADATA[annotationType])&&_ANNOTATION_TYPES_MET.supportNativeSource&&sources.unshift(ANNOTATION_SOURCE_TYPES_METADATA.NATIVE),sources}isValidFormulaAnnotation(expression,annotationType){return annotationType!==ANNOTATION_TYPES.FORMULA||(0,math_expression.$)(expression)}isValidForm(){const{name,annotationType,sourceType,value,timeColumn,intervalEndColumn}=this.state,errors=[(0,validateNonEmpty.Z)(name),(0,validateNonEmpty.Z)(annotationType),(0,validateNonEmpty.Z)(value)];return sourceType!==ANNOTATION_SOURCE_TYPES.NATIVE&&(annotationType===ANNOTATION_TYPES.EVENT&&errors.push((0,validateNonEmpty.Z)(timeColumn)),annotationType===ANNOTATION_TYPES.INTERVAL&&(errors.push((0,validateNonEmpty.Z)(timeColumn)),errors.push((0,validateNonEmpty.Z)(intervalEndColumn)))),errors.push(!this.isValidFormulaAnnotation(value,annotationType)),!errors.filter((x=>x)).length}handleAnnotationType(annotationType){this.setState({annotationType,sourceType:null,value:null})}handleAnnotationSourceType(sourceType){const{sourceType:prevSourceType}=this.state;prevSourceType!==sourceType&&this.setState({sourceType,value:null,isLoadingOptions:!0})}handleValue(value){this.setState({value,descriptionColumns:[],intervalEndColumn:null,timeColumn:null,titleColumn:null,overrides:{time_range:null}})}fetchOptions(annotationType,sourceType,isLoadingOptions){if(isLoadingOptions)if(sourceType===ANNOTATION_SOURCE_TYPES.NATIVE){const queryParams=rison_default().encode({page:0,page_size:constants.cM});SupersetClient.Z.get({endpoint:`/api/v1/annotation_layer/?q=${queryParams}`}).then((_ref3=>{let{json}=_ref3;const layers=json?json.result.map((layer=>({value:layer.id,label:layer.name}))):[];this.setState({isLoadingOptions:!1,valueOptions:layers})}))}else if(requiresQuery(sourceType)){const queryParams=rison_default().encode({filters:[{col:"id",opr:"chart_owned_created_favored_by_me",value:!0}],order_column:"slice_name",order_direction:"asc",page:0,page_size:constants.cM});SupersetClient.Z.get({endpoint:`/api/v1/chart/?q=${queryParams}`}).then((_ref4=>{let{json}=_ref4;const registry=(0,ChartMetadataRegistrySingleton.Z)();this.setState({isLoadingOptions:!1,valueOptions:json.result.filter((x=>{const metadata=registry.get(x.viz_type);return metadata&&metadata.canBeAnnotationType(annotationType)})).map((x=>{var _x$form_data$groupby;return{value:x.id,label:x.slice_name,slice:{...x,data:{...x.form_data,groupby:null==(_x$form_data$groupby=x.form_data.groupby)?void 0:_x$form_data$groupby.map((column=>(0,getColumnLabel.Z)(column)))}}}}))})}))}else this.setState({isLoadingOptions:!1,valueOptions:[]})}deleteAnnotation(){this.props.removeAnnotationLayer(),this.props.close()}applyAnnotation(){if(this.isValidForm()){const newAnnotation={};["name","annotationType","sourceType","color","opacity","style","width","showMarkers","hideLine","value","overrides","show","showLabel","titleColumn","descriptionColumns","timeColumn","intervalEndColumn"].forEach((field=>{null!==this.state[field]&&(newAnnotation[field]=this.state[field])})),""===newAnnotation.color&&(newAnnotation.color=null),this.props.addAnnotationLayer(newAnnotation),this.setState({isNew:!1})}}submitAnnotation(){this.applyAnnotation(),this.props.close()}renderOption(option){return(0,emotion_react_browser_esm.tZ)("span",{css:_ref5,title:option.label},option.label)}renderValueConfiguration(){const{annotationType,sourceType,value,valueOptions,isLoadingOptions}=this.state;let label="",description="";return requiresQuery(sourceType)?sourceType===ANNOTATION_SOURCE_TYPES.NATIVE?(label=(0,TranslatorSingleton.t)("Annotation layer"),description=(0,TranslatorSingleton.t)("Select the Annotation Layer you would like to use.")):(label=(0,TranslatorSingleton.t)("Chart"),description=(0,TranslatorSingleton.t)("Use another existing chart as a source for annotations and overlays.\n          Your chart must be one of these visualization types: [%s]",this.getSupportedSourceTypes(annotationType).map((x=>x.label)).join(", "))):annotationType===ANNOTATION_TYPES.FORMULA&&(label=(0,TranslatorSingleton.t)("Formula"),description=(0,TranslatorSingleton.t)("Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'")),requiresQuery(sourceType)?(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer value"),name:"annotation-layer-value",showHeader:!0,hovered:!0,description,label,placeholder:"",options:valueOptions,isLoading:isLoadingOptions,value,onChange:this.handleValue,validationErrors:value?[]:["Mandatory"],optionRenderer:this.renderOption,notFoundContent:(0,emotion_react_browser_esm.tZ)(NotFoundContent,null)}):annotationType===ANNOTATION_TYPES.FORMULA?(0,emotion_react_browser_esm.tZ)(TextControl.Z,{name:"annotation-layer-value",hovered:!0,showHeader:!0,description,label,placeholder:"",value,onChange:this.handleValue,validationErrors:this.isValidFormulaAnnotation(value,annotationType)?[]:[(0,TranslatorSingleton.t)("Bad formula.")]}):""}renderSliceConfiguration(){const{annotationType,sourceType,value,valueOptions,overrides,titleColumn,timeColumn,intervalEndColumn,descriptionColumns}=this.state,{slice}=valueOptions.find((x=>x.value===value))||{};if(sourceType!==ANNOTATION_SOURCE_TYPES.NATIVE&&slice){const columns=(slice.data.groupby||[]).concat(slice.data.all_columns||[]).map((x=>({value:x,label:x}))),timeColumnOptions=slice.data.include_time?[{value:"__timestamp",label:"__timestamp"}].concat(columns):columns;return(0,emotion_react_browser_esm.tZ)("div",{style:{marginRight:"2rem"}},(0,emotion_react_browser_esm.tZ)(PopoverSection.Z,{isSelected:!0,title:(0,TranslatorSingleton.t)("Annotation Slice Configuration"),info:(0,TranslatorSingleton.t)("This section allows you to configure how to use the slice\n              to generate annotations.")},(annotationType===ANNOTATION_TYPES.EVENT||annotationType===ANNOTATION_TYPES.INTERVAL)&&(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer time column"),hovered:!0,name:"annotation-layer-time-column",label:annotationType===ANNOTATION_TYPES.INTERVAL?(0,TranslatorSingleton.t)("Interval start column"):(0,TranslatorSingleton.t)("Event time column"),description:(0,TranslatorSingleton.t)("This column must contain date/time information."),validationErrors:timeColumn?[]:["Mandatory"],clearable:!1,options:timeColumnOptions,value:timeColumn,onChange:v=>this.setState({timeColumn:v})}),annotationType===ANNOTATION_TYPES.INTERVAL&&(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer interval end"),hovered:!0,name:"annotation-layer-intervalEnd",label:(0,TranslatorSingleton.t)("Interval End column"),description:(0,TranslatorSingleton.t)("This column must contain date/time information."),validationErrors:intervalEndColumn?[]:["Mandatory"],options:columns,value:intervalEndColumn,onChange:value=>this.setState({intervalEndColumn:value})}),(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer title column"),hovered:!0,name:"annotation-layer-title",label:(0,TranslatorSingleton.t)("Title Column"),description:(0,TranslatorSingleton.t)("Pick a title for you annotation."),options:[{value:"",label:(0,TranslatorSingleton.t)("None")}].concat(columns),value:titleColumn,onChange:value=>this.setState({titleColumn:value})}),annotationType!==ANNOTATION_TYPES.TIME_SERIES&&(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer description columns"),hovered:!0,name:"annotation-layer-title",label:(0,TranslatorSingleton.t)("Description Columns"),description:(0,TranslatorSingleton.t)("Pick one or more columns that should be shown in the annotation. If you don't select a column all of them will be shown."),multi:!0,options:columns,value:descriptionColumns,onChange:value=>this.setState({descriptionColumns:value})}),(0,emotion_react_browser_esm.tZ)("div",{style:{marginTop:"1rem"}},(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{hovered:!0,name:"annotation-override-time_range",label:(0,TranslatorSingleton.t)("Override time range"),description:(0,TranslatorSingleton.t)('This controls whether the "time_range" field from the current\n                  view should be passed down to the chart containing the annotation data.'),value:"time_range"in overrides,onChange:v=>{delete overrides.time_range,v?this.setState({overrides:{...overrides,time_range:null}}):this.setState({overrides:{...overrides}})}}),(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{hovered:!0,name:"annotation-override-timegrain",label:(0,TranslatorSingleton.t)("Override time grain"),description:(0,TranslatorSingleton.t)("This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data."),value:"time_grain_sqla"in overrides,onChange:v=>{delete overrides.time_grain_sqla,delete overrides.granularity,v?this.setState({overrides:{...overrides,time_grain_sqla:null,granularity:null}}):this.setState({overrides:{...overrides}})}}),(0,emotion_react_browser_esm.tZ)(TextControl.Z,{hovered:!0,name:"annotation-layer-timeshift",label:(0,TranslatorSingleton.t)("Time Shift"),description:(0,TranslatorSingleton.t)("Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)"),placeholder:"",value:overrides.time_shift,onChange:v=>this.setState({overrides:{...overrides,time_shift:v}})}))))}return""}renderDisplayConfiguration(){const{color,opacity,style,width,showMarkers,hideLine,annotationType}=this.state,colorScheme=(0,CategoricalSchemeRegistrySingleton.Z)().get(this.props.colorScheme).colors.concat();return color&&""!==color&&!colorScheme.find((x=>x.toLowerCase()===color.toLowerCase()))&&colorScheme.push(color),(0,emotion_react_browser_esm.tZ)(PopoverSection.Z,{isSelected:!0,title:(0,TranslatorSingleton.t)("Display configuration"),info:(0,TranslatorSingleton.t)("Configure your how you overlay is displayed here.")},(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer stroke"),name:"annotation-layer-stroke",label:(0,TranslatorSingleton.t)("Style"),options:[{value:"solid",label:(0,TranslatorSingleton.t)("Solid")},{value:"dashed",label:(0,TranslatorSingleton.t)("Dashed")},{value:"longDashed",label:(0,TranslatorSingleton.t)("Long dashed")},{value:"dotted",label:(0,TranslatorSingleton.t)("Dotted")}],value:style,clearable:!1,onChange:v=>this.setState({style:v})}),(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer opacity"),name:"annotation-layer-opacity",label:(0,TranslatorSingleton.t)("Opacity"),options:[{value:"",label:(0,TranslatorSingleton.t)("Solid")},{value:"opacityLow",label:"0.2"},{value:"opacityMedium",label:"0.5"},{value:"opacityHigh",label:"0.8"}],value:opacity,onChange:value=>this.setState({opacity:value})}),(0,emotion_react_browser_esm.tZ)("div",null,(0,emotion_react_browser_esm.tZ)(ControlHeader.Z,{label:(0,TranslatorSingleton.t)("Color")}),(0,emotion_react_browser_esm.tZ)("div",{style:{display:"flex",flexDirection:"column"}},(0,emotion_react_browser_esm.tZ)(lib.Ie,{color,colors:colorScheme,onChangeComplete:v=>this.setState({color:v.hex})}),(0,emotion_react_browser_esm.tZ)(Button.Z,{style:{marginTop:"0.5rem",marginBottom:"0.5rem"},buttonStyle:""===color?"success":"default",buttonSize:"xsmall",onClick:()=>this.setState({color:""})},(0,TranslatorSingleton.t)("Automatic Color")))),(0,emotion_react_browser_esm.tZ)(TextControl.Z,{name:"annotation-layer-stroke-width",label:(0,TranslatorSingleton.t)("Line width"),isInt:!0,value:width,onChange:v=>this.setState({width:v})}),annotationType===ANNOTATION_TYPES.TIME_SERIES&&(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{hovered:!0,name:"annotation-layer-show-markers",label:(0,TranslatorSingleton.t)("Show Markers"),description:(0,TranslatorSingleton.t)("Shows or hides markers for the time series"),value:showMarkers,onChange:v=>this.setState({showMarkers:v})}),annotationType===ANNOTATION_TYPES.TIME_SERIES&&(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{hovered:!0,name:"annotation-layer-hide-line",label:(0,TranslatorSingleton.t)("Hide Line"),description:(0,TranslatorSingleton.t)("Hides the Line for the time series"),value:hideLine,onChange:v=>this.setState({hideLine:v})}))}render(){const{isNew,name,annotationType,sourceType,show,showLabel}=this.state,isValid=this.isValidForm(),metadata=(0,ChartMetadataRegistrySingleton.Z)().get(this.props.vizType),supportedAnnotationTypes=metadata?metadata.supportedAnnotationTypes.map((type=>ANNOTATION_TYPES_METADATA[type])):[],supportedSourceTypes=this.getSupportedSourceTypes(annotationType);return(0,emotion_react_browser_esm.tZ)(react.Fragment,null,this.props.error&&(0,emotion_react_browser_esm.tZ)("span",{style:{color:this.props.theme.colors.error.base}},"ERROR: ",this.props.error),(0,emotion_react_browser_esm.tZ)("div",{style:{display:"flex",flexDirection:"row"}},(0,emotion_react_browser_esm.tZ)("div",{style:{marginRight:"2rem"}},(0,emotion_react_browser_esm.tZ)(PopoverSection.Z,{isSelected:!0,title:(0,TranslatorSingleton.t)("Layer configuration"),info:(0,TranslatorSingleton.t)("Configure the basics of your Annotation Layer.")},(0,emotion_react_browser_esm.tZ)(TextControl.Z,{name:"annotation-layer-name",label:(0,TranslatorSingleton.t)("Name"),placeholder:"",value:name,onChange:v=>this.setState({name:v}),validationErrors:name?[]:[(0,TranslatorSingleton.t)("Mandatory")]}),(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{name:"annotation-layer-hide",label:(0,TranslatorSingleton.t)("Hide layer"),value:!show,onChange:v=>this.setState({show:!v})}),(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{name:"annotation-label-show",label:(0,TranslatorSingleton.t)("Show label"),value:showLabel,hovered:!0,description:(0,TranslatorSingleton.t)("Whether to always show the annotation label"),onChange:v=>this.setState({showLabel:v})}),(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation layer type"),hovered:!0,description:(0,TranslatorSingleton.t)("Choose the annotation layer type"),label:(0,TranslatorSingleton.t)("Annotation layer type"),name:"annotation-layer-type",clearable:!1,options:supportedAnnotationTypes,value:annotationType,onChange:this.handleAnnotationType}),supportedSourceTypes.length>0&&(0,emotion_react_browser_esm.tZ)(SelectControl.Z,{ariaLabel:(0,TranslatorSingleton.t)("Annotation source type"),hovered:!0,description:(0,TranslatorSingleton.t)("Choose the source of your annotations"),label:(0,TranslatorSingleton.t)("Annotation source"),name:"annotation-source-type",options:supportedSourceTypes,notFoundContent:(0,emotion_react_browser_esm.tZ)(NotFoundContent,null),value:sourceType,onChange:this.handleAnnotationSourceType,validationErrors:sourceType?[]:[(0,TranslatorSingleton.t)("Mandatory")]}),this.renderValueConfiguration())),this.renderSliceConfiguration(),this.renderDisplayConfiguration()),(0,emotion_react_browser_esm.tZ)("div",{style:{display:"flex",justifyContent:"space-between"}},isNew?(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",onClick:()=>this.props.close()},(0,TranslatorSingleton.t)("Cancel")):(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",onClick:this.deleteAnnotation},(0,TranslatorSingleton.t)("Remove")),(0,emotion_react_browser_esm.tZ)("div",null,(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",disabled:!isValid,onClick:this.applyAnnotation},(0,TranslatorSingleton.t)("Apply")),(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",buttonStyle:"primary",disabled:!isValid,onClick:this.submitAnnotation},(0,TranslatorSingleton.t)("OK")))))}}AnnotationLayer.propTypes=propTypes,AnnotationLayer.defaultProps=defaultProps;const AnnotationLayerControl_AnnotationLayer=(0,emotion_element_99289b21_browser_esm.b)(AnnotationLayer)},"./packages/superset-ui-core/src/math-expression/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>isValidExpression,f:()=>evalExpression});var math_expression_evaluator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/math-expression-evaluator/src/formula_evaluator.js"),math_expression_evaluator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(math_expression_evaluator__WEBPACK_IMPORTED_MODULE_0__);const REPLACE_OPERATORS=[[new RegExp(/==/g),"Eq"],[new RegExp(/>=/g),"Gte"],[new RegExp(/<=/g),"Lte"],[new RegExp(/>/g),"Gt"],[new RegExp(/</g),"Lt"]],TOKENS=[{type:3,token:"x",show:"x",value:"x"},{type:2,token:"&",show:"&",value:(a,b)=>a&b},{type:2,token:"|",show:"|",value:(a,b)=>a|b},{type:2,token:"and",show:"and",value:(a,b)=>a&&b},{type:2,token:"xor",show:"xor",value:(a,b)=>a^b},{type:2,token:"or",show:"or",value:(a,b)=>Number(a||b)},{type:2,token:"Eq",show:"Eq",value:(a,b)=>Number(a===b)},{type:2,token:"Lt",show:"Lt",value:(a,b)=>Number(a<b)},{type:2,token:"Lte",show:"Lte",value:(a,b)=>Number(a<=b)},{type:2,token:"Gt",show:"Gt",value:(a,b)=>Number(a>b)},{type:2,token:"Gte",show:"Gte",value:(a,b)=>Number(a>=b)}];function evalExpression(expression,value){var _subExpressions$;let parsedExpression=expression;REPLACE_OPERATORS.forEach((_ref=>{let[key,value]=_ref;parsedExpression=parsedExpression.replace(key,value)}));const subExpressions=String(parsedExpression).split("=");return parsedExpression=null!=(_subExpressions$=subExpressions[1])?_subExpressions$:subExpressions[0],Number(math_expression_evaluator__WEBPACK_IMPORTED_MODULE_0___default().eval(parsedExpression,TOKENS,{x:value}))}function isValidExpression(expression){try{evalExpression(expression,0)}catch(err){return!1}return!0}}}]);
//# sourceMappingURL=4199.e4416211.iframe.bundle.js.map