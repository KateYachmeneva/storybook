"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9410],{"./src/components/Datasource/DatasourceEditor.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Datasource_DatasourceEditor});var emotion_react_browser_esm=__webpack_require__("./node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),rison=__webpack_require__("./node_modules/rison/js/rison.js"),rison_default=__webpack_require__.n(rison),react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),Radio=__webpack_require__("./src/components/Radio/index.tsx"),Card=__webpack_require__("./src/components/Card/index.tsx"),Alert=__webpack_require__("./src/components/Alert/index.tsx"),Badge=__webpack_require__("./src/components/Badge/index.tsx"),shortid=__webpack_require__("./node_modules/shortid/index.js"),shortid_default=__webpack_require__.n(shortid),style=__webpack_require__("./packages/superset-ui-core/src/style/index.tsx"),TranslatorSingleton=__webpack_require__("./packages/superset-ui-core/src/translation/TranslatorSingleton.ts"),featureFlags=__webpack_require__("./packages/superset-ui-core/src/utils/featureFlags.ts"),SupersetClient=__webpack_require__("./packages/superset-ui-core/src/connection/SupersetClient.ts"),ensureIsArray=__webpack_require__("./packages/superset-ui-core/src/utils/ensureIsArray.ts"),CurrencyFormatter=__webpack_require__("./packages/superset-ui-core/src/currency-format/CurrencyFormatter.ts"),emotion_element_99289b21_browser_esm=__webpack_require__("./node_modules/@emotion/react/dist/emotion-element-99289b21.browser.esm.js"),components=__webpack_require__("./src/components/index.ts"),Form=__webpack_require__("./src/components/Form/index.tsx"),Button=__webpack_require__("./src/components/Button/index.tsx"),Tabs=__webpack_require__("./src/components/Tabs/index.ts"),CertifiedBadge=__webpack_require__("./src/components/CertifiedBadge/index.tsx"),WarningIconWithTooltip=__webpack_require__("./src/components/WarningIconWithTooltip/index.tsx"),Label=__webpack_require__("./src/components/Label/index.tsx"),RefreshLabel=__webpack_require__("./src/components/RefreshLabel/index.tsx"),withToasts=__webpack_require__("./src/components/MessageToasts/withToasts.tsx");__webpack_require__("./src/hooks/apiResources/apiResources.ts");rison_default().encode({columns:["owners.first_name","owners.last_name"],keys:["none"]});var tables=__webpack_require__("./src/hooks/apiResources/tables.ts"),schemas=__webpack_require__("./src/hooks/apiResources/schemas.ts");const queryValidationApi=__webpack_require__("./src/hooks/apiResources/queryApi.ts").h.injectEndpoints({endpoints:builder=>({queryValidations:builder.query({providesTags:["QueryValidations"],query:_ref=>{let{dbId,schema,sql,templateParams}=_ref,template_params=templateParams;try{template_params=JSON.parse(templateParams||"")}catch(e){template_params=void 0}const postPayload={schema,sql,...template_params&&{template_params}};return{method:"post",endpoint:`/api/v1/database/${dbId}/validate_sql/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(postPayload),transformResponse:_ref2=>{let{json}=_ref2;return json.result}}}})})}),{useQueryValidationsQuery}=queryValidationApi,DatabaseSelectorWrapper=style.iK.div`
  ${_ref=>{let{theme}=_ref;return`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${theme.gridUnit}px;\n      margin-top: ${5*theme.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${theme.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*theme.gridUnit}px;\n    }\n  `}}
`,LabelStyle=style.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${_ref2=>{let{theme}=_ref2;return theme.gridUnit-2}}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,SelectLabel=_ref3=>{let{backend,databaseName}=_ref3;return(0,emotion_react_browser_esm.tZ)(LabelStyle,null,(0,emotion_react_browser_esm.tZ)(Label.Z,{className:"backend"},backend||""),(0,emotion_react_browser_esm.tZ)("span",{className:"name",title:databaseName},databaseName))},EMPTY_SCHEMA_OPTIONS=[];function DatabaseSelector(_ref4){let{db,formMode=!1,emptyState,getDbList,handleError,isDatabaseSelectEnabled=!0,onDbChange,onEmptyResults,onSchemaChange,readOnly=!1,schema,sqlLabMode=!1}=_ref4;const[currentDb,setCurrentDb]=(0,react.useState)(),[currentSchema,setCurrentSchema]=(0,react.useState)(schema?{label:schema,value:schema,title:schema}:void 0),schemaRef=(0,react.useRef)(schema);schemaRef.current=schema;const{addSuccessToast}=(0,withToasts.e1)(),loadDatabases=(0,react.useMemo)((()=>async(search,page,pageSize)=>{const endpoint=`/api/v1/database/?q=${rison_default().encode({order_columns:"database_name",order_direction:"asc",page,page_size:pageSize,...formMode||!sqlLabMode?{filters:[{col:"database_name",opr:"ct",value:search}]}:{filters:[{col:"database_name",opr:"ct",value:search},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return SupersetClient.Z.get({endpoint}).then((_ref5=>{let{json}=_ref5;const{result}=json;getDbList&&getDbList(result),0===result.length&&onEmptyResults&&onEmptyResults(search);const options=result.map((row=>({label:(0,emotion_react_browser_esm.tZ)(SelectLabel,{backend:row.backend,databaseName:row.database_name}),value:row.id,id:row.id,database_name:row.database_name,backend:row.backend})));return{data:options,totalCount:options.length}}))}),[formMode,getDbList,sqlLabMode]);function changeSchema(schema){setCurrentSchema(schema),onSchemaChange&&(null==schema?void 0:schema.value)!==schemaRef.current&&onSchemaChange(null==schema?void 0:schema.value)}(0,react.useEffect)((()=>{setCurrentDb((current=>(null==current?void 0:current.id)!==(null==db?void 0:db.id)?db?{label:(0,emotion_react_browser_esm.tZ)(SelectLabel,{backend:db.backend,databaseName:db.database_name}),value:db.id,...db}:void 0:current))}),[db]);const{data,isFetching:loadingSchemas,refetch}=(0,schemas.Xx)({dbId:null==currentDb?void 0:currentDb.value,onSuccess:(schemas,isFetched)=>{1===schemas.length?changeSchema(schemas[0]):schemas.find((schemaOption=>schemaRef.current===schemaOption.value))||changeSchema(void 0),isFetched&&addSuccessToast("List refreshed")},onError:()=>handleError((0,TranslatorSingleton.t)("There was an error loading the schemas"))}),schemaOptions=data||EMPTY_SCHEMA_OPTIONS;function changeDataBase(value,database){setCurrentDb(database),setCurrentSchema(void 0),onDbChange&&onDbChange(database),onSchemaChange&&onSchemaChange(void 0)}function renderSelectRow(select,refreshBtn){return(0,emotion_react_browser_esm.tZ)("div",{className:"section"},(0,emotion_react_browser_esm.tZ)("span",{className:"select"},select),(0,emotion_react_browser_esm.tZ)("span",{className:"refresh"},refreshBtn))}return(0,emotion_react_browser_esm.tZ)(DatabaseSelectorWrapper,null,function renderDatabaseSelect(){return renderSelectRow((0,emotion_react_browser_esm.tZ)(components.qb,{ariaLabel:(0,TranslatorSingleton.t)("Select database or type to search databases"),optionFilterProps:["database_name","value"],header:(0,emotion_react_browser_esm.tZ)(Form.lX,null,(0,TranslatorSingleton.t)("Database")),lazyLoading:!1,notFoundContent:emptyState,onChange:changeDataBase,value:currentDb,placeholder:(0,TranslatorSingleton.t)("Select database or type to search databases"),disabled:!isDatabaseSelectEnabled||readOnly,options:loadDatabases}),null)}(),function renderSchemaSelect(){const refreshIcon=!readOnly&&(0,emotion_react_browser_esm.tZ)(RefreshLabel.Z,{onClick:()=>refetch(),tooltipContent:(0,TranslatorSingleton.t)("Force refresh schema list")});return renderSelectRow((0,emotion_react_browser_esm.tZ)(components.Ph,{ariaLabel:(0,TranslatorSingleton.t)("Select schema or type to search schemas"),disabled:!currentDb||readOnly,header:(0,emotion_react_browser_esm.tZ)(Form.lX,null,(0,TranslatorSingleton.t)("Schema")),labelInValue:!0,loading:loadingSchemas,name:"select-schema",notFoundContent:(0,TranslatorSingleton.t)("No compatible schema found"),placeholder:(0,TranslatorSingleton.t)("Select schema or type to search schemas"),onChange:item=>changeSchema(item),options:schemaOptions,showSearch:!0,value:currentSchema}),refreshIcon)}())}try{DatabaseSelector.displayName="DatabaseSelector",DatabaseSelector.__docgenInfo={description:"",displayName:"DatabaseSelector",props:{db:{defaultValue:null,description:"",name:"db",required:!1,type:{name:"DatabaseObject | null"}},emptyState:{defaultValue:null,description:"",name:"emptyState",required:!1,type:{name:"ReactNode"}},formMode:{defaultValue:{value:"false"},description:"",name:"formMode",required:!1,type:{name:"boolean"}},getDbList:{defaultValue:null,description:"",name:"getDbList",required:!1,type:{name:"((arg0: any) => void)"}},handleError:{defaultValue:null,description:"",name:"handleError",required:!0,type:{name:"(msg: string) => void"}},isDatabaseSelectEnabled:{defaultValue:{value:"true"},description:"",name:"isDatabaseSelectEnabled",required:!1,type:{name:"boolean"}},onDbChange:{defaultValue:null,description:"",name:"onDbChange",required:!1,type:{name:"((db: DatabaseObject) => void)"}},onEmptyResults:{defaultValue:null,description:"",name:"onEmptyResults",required:!1,type:{name:"((searchText?: string) => void)"}},onSchemaChange:{defaultValue:null,description:"",name:"onSchemaChange",required:!1,type:{name:"((schema?: string) => void)"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"string"}},sqlLabMode:{defaultValue:{value:"false"},description:"",name:"sqlLabMode",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/DatabaseSelector/index.tsx#DatabaseSelector"]={docgenInfo:DatabaseSelector.__docgenInfo,name:"DatabaseSelector",path:"src/components/DatabaseSelector/index.tsx#DatabaseSelector"})}catch(__react_docgen_typescript_loader_error){}var Loading=__webpack_require__("./src/components/Loading/index.tsx"),Icons=__webpack_require__("./src/components/Icons/index.tsx"),getClientErrorObject=__webpack_require__("./src/utils/getClientErrorObject.ts");const TableSelectorWrapper=style.iK.div`
  ${_ref=>{let{theme}=_ref;return`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${theme.gridUnit}px;\n      margin-top: ${5*theme.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${theme.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${theme.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n      max-width: calc(100% - ${theme.gridUnit+30}px)\n    }\n  `}}
`,TableLabel=style.iK.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${_ref2=>{let{theme}=_ref2;return theme.gridUnit}}px;
  }
`,TableOption=_ref3=>{let{table}=_ref3;const{value,type,extra}=table;return(0,emotion_react_browser_esm.tZ)(TableLabel,{title:value},"view"===type?(0,emotion_react_browser_esm.tZ)(Icons.Z.Eye,{iconSize:"m"}):(0,emotion_react_browser_esm.tZ)(Icons.Z.Table,{iconSize:"m"}),(null==extra?void 0:extra.certification)&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:extra.certification.certified_by,details:extra.certification.details,size:"l"}),(null==extra?void 0:extra.warning_markdown)&&(0,emotion_react_browser_esm.tZ)(WarningIconWithTooltip.Z,{warningMarkdown:extra.warning_markdown,size:"l",marginRight:4}),value)};const TableSelector=_ref4=>{let{database,emptyState,formMode=!1,getDbList,handleError,isDatabaseSelectEnabled=!0,onDbChange,onSchemaChange,readOnly=!1,onEmptyResults,schema,sqlLabMode=!0,tableSelectMode="single",tableValue,onTableSelectChange,customTableOptionLabelRenderer}=_ref4;const{addSuccessToast}=(0,withToasts.e1)(),[currentSchema,setCurrentSchema]=(0,react.useState)(schema),[tableSelectValue,setTableSelectValue]=(0,react.useState)(void 0),{data,isFetching:loadingTables,refetch}=(0,tables.zA)({dbId:null==database?void 0:database.id,schema:currentSchema,onSuccess:(data,isFetched)=>{isFetched&&addSuccessToast((0,TranslatorSingleton.t)("List updated"))},onError:err=>{(0,getClientErrorObject.O$)(err).then((clientError=>{handleError((0,getClientErrorObject.d7)((0,TranslatorSingleton.t)("There was an error loading the tables"),clientError))}))}}),tableOptions=(0,react.useMemo)((()=>data?data.options.map((table=>({value:table.value,label:(0,emotion_react_browser_esm.tZ)(TableOption,{table}),text:table.value,...customTableOptionLabelRenderer&&{customLabel:customTableOptionLabelRenderer(table)}}))):[]),[data,customTableOptionLabelRenderer]);(0,react.useEffect)((()=>{void 0===database&&(setCurrentSchema(void 0),setTableSelectValue(void 0))}),[database,tableSelectMode]),(0,react.useEffect)((()=>{setTableSelectValue("single"===tableSelectMode?tableOptions.find((option=>option.value===tableValue)):(null==tableOptions?void 0:tableOptions.filter((option=>option&&(null==tableValue?void 0:tableValue.includes(option.value)))))||[])}),[tableOptions,tableValue,tableSelectMode]);const internalTableChange=selectedOptions=>{currentSchema?null==onTableSelectChange||onTableSelectChange(Array.isArray(selectedOptions)?selectedOptions.map((option=>null==option?void 0:option.value)):null==selectedOptions?void 0:selectedOptions.value,currentSchema):setTableSelectValue(selectedOptions)},handleFilterOption=(0,react.useMemo)((()=>(search,option)=>{const searchValue=search.trim().toLowerCase(),{value}=option;return value.toLowerCase().includes(searchValue)}),[]);return(0,emotion_react_browser_esm.tZ)(TableSelectorWrapper,null,(0,emotion_react_browser_esm.tZ)(DatabaseSelector,{db:database,emptyState,formMode,getDbList,handleError,onDbChange:readOnly?void 0:db=>{onDbChange&&onDbChange(db)},onEmptyResults,onSchemaChange:readOnly?void 0:schema=>{setCurrentSchema(schema),onSchemaChange&&onSchemaChange(schema);internalTableChange("single"===tableSelectMode?void 0:[])},schema:currentSchema,sqlLabMode,isDatabaseSelectEnabled:isDatabaseSelectEnabled&&!readOnly,readOnly}),sqlLabMode&&!formMode&&(0,emotion_react_browser_esm.tZ)("div",{className:"divider"}),function renderTableSelect(){const disabled=currentSchema&&!formMode&&readOnly||!currentSchema,header=sqlLabMode?(0,emotion_react_browser_esm.tZ)(Form.lX,null,(0,TranslatorSingleton.t)("See table schema")):(0,emotion_react_browser_esm.tZ)(Form.lX,null,(0,TranslatorSingleton.t)("Table"));return function renderSelectRow(select,refreshBtn){return(0,emotion_react_browser_esm.tZ)("div",{className:"section"},(0,emotion_react_browser_esm.tZ)("span",{className:"select"},select),(0,emotion_react_browser_esm.tZ)("span",{className:"refresh"},refreshBtn))}((0,emotion_react_browser_esm.tZ)(components.Ph,{ariaLabel:(0,TranslatorSingleton.t)("Select table or type to search tables"),disabled,filterOption:handleFilterOption,header,labelInValue:!0,loading:loadingTables,name:"select-table",onChange:options=>internalTableChange(options),options:tableOptions,placeholder:(0,TranslatorSingleton.t)("Select table or type to search tables"),showSearch:!0,mode:tableSelectMode,value:tableSelectValue,allowClear:"multiple"===tableSelectMode,allowSelectAll:!1}),!readOnly&&(0,emotion_react_browser_esm.tZ)(RefreshLabel.Z,{onClick:()=>refetch(),tooltipContent:(0,TranslatorSingleton.t)("Force refresh table list")}))}())},TableSelectorMultiple=props=>___EmotionJSX(TableSelector,_extends({tableSelectMode:"multiple"},props)),components_TableSelector=TableSelector;try{TableOption.displayName="TableOption",TableOption.__docgenInfo={description:"",displayName:"TableOption",props:{table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/TableSelector/index.tsx#TableOption"]={docgenInfo:TableOption.__docgenInfo,name:"TableOption",path:"src/components/TableSelector/index.tsx#TableOption"})}catch(__react_docgen_typescript_loader_error){}try{TableSelectorMultiple.displayName="TableSelectorMultiple",TableSelectorMultiple.__docgenInfo={description:"",displayName:"TableSelectorMultiple",props:{clearable:{defaultValue:null,description:"",name:"clearable",required:!1,type:{name:"boolean"}},database:{defaultValue:null,description:"",name:"database",required:!1,type:{name:"DatabaseObject | null"}},emptyState:{defaultValue:null,description:"",name:"emptyState",required:!1,type:{name:"ReactNode"}},formMode:{defaultValue:{value:"false"},description:"",name:"formMode",required:!1,type:{name:"boolean"}},getDbList:{defaultValue:null,description:"",name:"getDbList",required:!1,type:{name:"((arg0: any) => void)"}},handleError:{defaultValue:null,description:"",name:"handleError",required:!0,type:{name:"(msg: string) => void"}},isDatabaseSelectEnabled:{defaultValue:{value:"true"},description:"",name:"isDatabaseSelectEnabled",required:!1,type:{name:"boolean"}},onDbChange:{defaultValue:null,description:"",name:"onDbChange",required:!1,type:{name:"((db: DatabaseObject) => void)"}},onSchemaChange:{defaultValue:null,description:"",name:"onSchemaChange",required:!1,type:{name:"((schema?: string) => void)"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"string"}},onEmptyResults:{defaultValue:null,description:"",name:"onEmptyResults",required:!1,type:{name:"((searchText?: string) => void)"}},sqlLabMode:{defaultValue:{value:"true"},description:"",name:"sqlLabMode",required:!1,type:{name:"boolean"}},tableValue:{defaultValue:{value:"undefined"},description:"",name:"tableValue",required:!1,type:{name:"string | string[]"}},onTableSelectChange:{defaultValue:null,description:"",name:"onTableSelectChange",required:!1,type:{name:"((value?: string | string[], schema?: string) => void) | undefined"}},tableSelectMode:{defaultValue:{value:"single"},description:"",name:"tableSelectMode",required:!1,type:{name:"enum",value:[{value:'"multiple"'},{value:'"single"'}]}},customTableOptionLabelRenderer:{defaultValue:null,description:"",name:"customTableOptionLabelRenderer",required:!1,type:{name:"((table: Table) => Element)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/TableSelector/index.tsx#TableSelectorMultiple"]={docgenInfo:TableSelectorMultiple.__docgenInfo,name:"TableSelectorMultiple",path:"src/components/TableSelector/index.tsx#TableSelectorMultiple"})}catch(__react_docgen_typescript_loader_error){}try{TableSelector.displayName="TableSelector",TableSelector.__docgenInfo={description:"",displayName:"TableSelector",props:{clearable:{defaultValue:null,description:"",name:"clearable",required:!1,type:{name:"boolean"}},database:{defaultValue:null,description:"",name:"database",required:!1,type:{name:"DatabaseObject | null"}},emptyState:{defaultValue:null,description:"",name:"emptyState",required:!1,type:{name:"ReactNode"}},formMode:{defaultValue:{value:"false"},description:"",name:"formMode",required:!1,type:{name:"boolean"}},getDbList:{defaultValue:null,description:"",name:"getDbList",required:!1,type:{name:"((arg0: any) => void)"}},handleError:{defaultValue:null,description:"",name:"handleError",required:!0,type:{name:"(msg: string) => void"}},isDatabaseSelectEnabled:{defaultValue:{value:"true"},description:"",name:"isDatabaseSelectEnabled",required:!1,type:{name:"boolean"}},onDbChange:{defaultValue:null,description:"",name:"onDbChange",required:!1,type:{name:"((db: DatabaseObject) => void)"}},onSchemaChange:{defaultValue:null,description:"",name:"onSchemaChange",required:!1,type:{name:"((schema?: string) => void)"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"",name:"schema",required:!1,type:{name:"string"}},onEmptyResults:{defaultValue:null,description:"",name:"onEmptyResults",required:!1,type:{name:"((searchText?: string) => void)"}},sqlLabMode:{defaultValue:{value:"true"},description:"",name:"sqlLabMode",required:!1,type:{name:"boolean"}},tableValue:{defaultValue:{value:"undefined"},description:"",name:"tableValue",required:!1,type:{name:"string | string[]"}},onTableSelectChange:{defaultValue:null,description:"",name:"onTableSelectChange",required:!1,type:{name:"((value?: string | string[], schema?: string) => void) | undefined"}},tableSelectMode:{defaultValue:{value:"single"},description:"",name:"tableSelectMode",required:!1,type:{name:"enum",value:[{value:'"multiple"'},{value:'"single"'}]}},customTableOptionLabelRenderer:{defaultValue:null,description:"",name:"customTableOptionLabelRenderer",required:!1,type:{name:"((table: Table) => Element)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/TableSelector/index.tsx#TableSelector"]={docgenInfo:TableSelector.__docgenInfo,name:"TableSelector",path:"src/components/TableSelector/index.tsx#TableSelector"})}catch(__react_docgen_typescript_loader_error){}var EditableTitle=__webpack_require__("./src/components/EditableTitle/index.tsx"),CheckboxControl=__webpack_require__("./src/explore/components/controls/CheckboxControl.jsx"),TextControl=__webpack_require__("./src/explore/components/controls/TextControl/index.tsx"),TextAreaControl=__webpack_require__("./src/explore/components/controls/TextAreaControl.jsx"),SpatialControl=__webpack_require__("./src/explore/components/controls/SpatialControl.jsx"),CurrencyControl=__webpack_require__("./src/explore/components/controls/CurrencyControl/index.ts"),esm_extends=__webpack_require__("./node_modules/@babel/runtime-corejs3/helpers/esm/extends.js"),InfoTooltipWithTrigger=__webpack_require__("./packages/superset-ui-chart-controls/src/components/InfoTooltipWithTrigger.tsx");function recurseReactClone(children,type,propExtender){return react.Children.map(children,(child=>{let newChild=child;return child&&child.type.name===type.name&&(newChild=react.cloneElement(child,propExtender(child))),newChild&&newChild.props.children&&(newChild=react.cloneElement(newChild,{children:recurseReactClone(newChild.props.children,type,propExtender)})),newChild}))}var Tooltip=__webpack_require__("./src/components/Tooltip/index.tsx");const formItemInlineCss=emotion_react_browser_esm.iv`
  .ant-form-item-control-input-content {
    display: flex;
    flex-direction: row;
  }
`;function Field(_ref){let{fieldKey,value,label,description=null,control,onChange=()=>{},compact=!1,inline}=_ref;const onControlChange=(0,react.useCallback)((newValue=>{onChange(fieldKey,newValue)}),[onChange,fieldKey]),hookedControl=react.cloneElement(control,{value,onChange:onControlChange});return(0,emotion_react_browser_esm.tZ)(Form.xJ,{label:(0,emotion_react_browser_esm.tZ)(Form.lX,{className:"m-r-5"},label||fieldKey,compact&&description&&(0,emotion_react_browser_esm.tZ)(Tooltip.u,{id:"field-descr",placement:"right",title:description},(0,emotion_react_browser_esm.tZ)("i",{className:"fa fa-info-circle m-l-5"}))),css:inline&&formItemInlineCss},hookedControl,!compact&&description&&(0,emotion_react_browser_esm.tZ)("div",{css:theme=>({color:theme.colors.grayscale.base,[inline?"marginLeft":"marginTop"]:theme.gridUnit})},description))}try{Field.displayName="Field",Field.__docgenInfo={description:"",displayName:"Field",props:{fieldKey:{defaultValue:null,description:"",name:"fieldKey",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"V"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},description:{defaultValue:{value:"null"},description:"",name:"description",required:!1,type:{name:"ReactNode"}},control:{defaultValue:null,description:"",name:"control",required:!0,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},onChange:{defaultValue:{value:"() => {}"},description:"",name:"onChange",required:!1,type:{name:"(fieldKey: string, newValue: V) => void"}},compact:{defaultValue:{value:"false"},description:"",name:"compact",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Datasource/Field.tsx#Field"]={docgenInfo:Field.__docgenInfo,name:"Field",path:"src/components/Datasource/Field.tsx#Field"})}catch(__react_docgen_typescript_loader_error){}class Fieldset extends react.PureComponent{constructor(props){super(props),this.onChange=this.onChange.bind(this)}onChange(fieldKey,val){return this.props.onChange({...this.props.item,[fieldKey]:val})}render(){const{title}=this.props;return(0,emotion_react_browser_esm.tZ)(Form.l0,{className:"CRUD",layout:"vertical"},title&&(0,emotion_react_browser_esm.tZ)("legend",null,title),recurseReactClone(this.props.children,Field,(field=>({onChange:this.onChange,value:this.props.item[field.props.fieldKey],compact:this.props.compact}))))}}Fieldset.defaultProps={compact:!1,title:null};try{Fieldset.displayName="Fieldset",Fieldset.__docgenInfo={description:"",displayName:"Fieldset",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"Function"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"Record<string, any>"}},title:{defaultValue:{value:"null"},description:"",name:"title",required:!1,type:{name:"ReactNode"}},compact:{defaultValue:{value:"false"},description:"",name:"compact",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Datasource/Fieldset.tsx#Fieldset"]={docgenInfo:Fieldset.__docgenInfo,name:"Fieldset",path:"src/components/Datasource/Fieldset.tsx#Fieldset"})}catch(__react_docgen_typescript_loader_error){}var SortOrder;function createKeyedCollection(arr){const collectionArray=arr.map((o=>({...o,id:o.id||shortid_default().generate()}))),collection={};return collectionArray.forEach((o=>{collection[o.id]=o})),{collection,collectionArray}}!function(SortOrder){SortOrder[SortOrder.asc=1]="asc",SortOrder[SortOrder.desc=2]="desc",SortOrder[SortOrder.unsort=0]="unsort"}(SortOrder||(SortOrder={}));const CrudTableWrapper=style.iK.div`
  ${_ref=>{let{stickyHeader}=_ref;return stickyHeader&&"\n      height: 350px;\n      overflow-y: auto;\n      overflow-x: auto;\n\n      .table {\n        min-width: 800px;\n      }\n      thead th {\n        background: #fff;\n        position: sticky;\n        top: 0;\n        z-index: 9;\n        min\n      }\n    "}}
  ${_ref2=>{let{theme}=_ref2;return`\n    th span {\n      vertical-align: ${-2*theme.gridUnit}px;\n    }\n    .text-right {\n      text-align: right;\n    }\n    .empty-collection {\n      padding: ${2*theme.gridUnit+2}px;\n    }\n    .tiny-cell {\n      width: ${theme.gridUnit+1}px;\n    }\n    i.fa-caret-down,\n    i.fa-caret-up {\n      width: ${theme.gridUnit+1}px;\n    }\n    td.expanded {\n      border-top: 0;\n      padding: 0;\n    }\n  `}}
`,CrudButtonWrapper=style.iK.div`
  text-align: right;
  ${_ref3=>{let{theme}=_ref3;return`margin-bottom: ${2*theme.gridUnit}px`}}
`,StyledButtonWrapper=style.iK.span`
  ${_ref4=>{let{theme}=_ref4;return`\n    margin-top: ${3*theme.gridUnit}px;\n    margin-left: ${3*theme.gridUnit}px;\n  `}}
`;class CRUDCollection extends react.PureComponent{constructor(props){super(props);const{collection,collectionArray}=createKeyedCollection(props.collection);this.state={expandedColumns:{},collection,collectionArray,sortColumn:"",sort:0},this.renderItem=this.renderItem.bind(this),this.onAddItem=this.onAddItem.bind(this),this.renderExpandableSection=this.renderExpandableSection.bind(this),this.getLabel=this.getLabel.bind(this),this.onFieldsetChange=this.onFieldsetChange.bind(this),this.renderTableBody=this.renderTableBody.bind(this),this.changeCollection=this.changeCollection.bind(this),this.sortColumn=this.sortColumn.bind(this),this.renderSortIcon=this.renderSortIcon.bind(this)}UNSAFE_componentWillReceiveProps(nextProps){if(nextProps.collection!==this.props.collection){const{collection,collectionArray}=createKeyedCollection(nextProps.collection);this.setState({collection,collectionArray})}}onCellChange(id,col,val){this.changeCollection({...this.state.collection,[id]:{...this.state.collection[id],[col]:val}})}onAddItem(){if(this.props.itemGenerator){let newItem=this.props.itemGenerator();newItem.id||(newItem={...newItem,id:shortid_default().generate()}),this.changeCollection(this.state.collection,newItem)}}onFieldsetChange(item){this.changeCollection({...this.state.collection,[item.id]:item})}getLabel(col){const{columnLabels}=this.props;let label=null!=columnLabels&&columnLabels[col]?columnLabels[col]:col;return label.startsWith("__")&&(label=""),label}getTooltip(col){const{columnLabelTooltips}=this.props;return null==columnLabelTooltips?void 0:columnLabelTooltips[col]}changeCollection(collection,newItem){if(this.setState({collection}),this.props.onChange){const collectionArray=this.state.collectionArray.map((c=>collection[c.id])).filter((c=>void 0!==c));newItem&&collectionArray.unshift(newItem),this.props.onChange(collectionArray)}}deleteItem(id){const newColl={...this.state.collection};delete newColl[id],this.changeCollection(newColl)}effectiveTableColumns(){const{tableColumns,allowDeletes,expandFieldset}=this.props,cols=allowDeletes?tableColumns.concat(["__actions"]):tableColumns;return expandFieldset?["__expand"].concat(cols):cols}toggleExpand(id){this.onCellChange(id,"__expanded",!1),this.setState((prevState=>({expandedColumns:{...prevState.expandedColumns,[id]:!prevState.expandedColumns[id]}})))}sortColumn(col,sort){void 0===sort&&(sort=SortOrder.unsort);const{sortColumns}=this.props;return()=>{if(null!=sortColumns&&sortColumns.includes(col)){if(sort===SortOrder.unsort){const{collection}=createKeyedCollection(this.props.collection),collectionArray=function createCollectionArray(collection){return Object.keys(collection).map((k=>collection[k]))}(collection);return void this.setState({collectionArray,sortColumn:"",sort})}const sorted=[...this.state.collectionArray].sort(((a,b)=>{return m=a[col],n=b[col],"string"==typeof m?(m||" ").localeCompare(n):m-n;var m,n})),newCollection=sort===SortOrder.asc?sorted:sorted.reverse();this.setState((prevState=>({...prevState,collectionArray:newCollection,sortColumn:col,sort})))}}}renderSortIcon(col){return this.state.sortColumn===col&&this.state.sort===SortOrder.asc?(0,emotion_react_browser_esm.tZ)(Icons.Z.SortAsc,{onClick:this.sortColumn(col,2)}):this.state.sortColumn===col&&this.state.sort===SortOrder.desc?(0,emotion_react_browser_esm.tZ)(Icons.Z.SortDesc,{onClick:this.sortColumn(col,0)}):(0,emotion_react_browser_esm.tZ)(Icons.Z.Sort,{onClick:this.sortColumn(col,1)})}renderTH(col,sortColumns){const tooltip=this.getTooltip(col);return(0,emotion_react_browser_esm.tZ)("th",{key:col,className:"no-wrap"},this.getLabel(col),tooltip&&(0,emotion_react_browser_esm.tZ)(react.Fragment,null," ",(0,emotion_react_browser_esm.tZ)(InfoTooltipWithTrigger.V,{label:(0,TranslatorSingleton.t)("description"),tooltip})),(null==sortColumns?void 0:sortColumns.includes(col))&&this.renderSortIcon(col))}renderHeaderRow(){const cols=this.effectiveTableColumns(),{allowDeletes,expandFieldset,extraButtons,sortColumns}=this.props;return(0,emotion_react_browser_esm.tZ)("thead",null,(0,emotion_react_browser_esm.tZ)("tr",null,expandFieldset&&(0,emotion_react_browser_esm.tZ)("th",{"aria-label":"Expand",className:"tiny-cell"}),cols.map((col=>this.renderTH(col,sortColumns))),extraButtons,allowDeletes&&(0,emotion_react_browser_esm.tZ)("th",{key:"delete-item","aria-label":"Delete",className:"tiny-cell"})))}renderExpandableSection(item){return recurseReactClone(this.props.expandFieldset,Fieldset,(()=>({item,onChange:this.onFieldsetChange})))}getCellProps(record,col){var _this$props$itemCellP;const cellPropsFn=null==(_this$props$itemCellP=this.props.itemCellProps)?void 0:_this$props$itemCellP[col],val=record[col];return cellPropsFn?cellPropsFn(val,this.getLabel(col),record):{}}renderCell(record,col){var _this$props$itemRende;const renderer=null==(_this$props$itemRende=this.props.itemRenderers)?void 0:_this$props$itemRende[col],val=record[col],onChange=this.onCellChange.bind(this,record.id,col);return renderer?renderer(val,onChange,this.getLabel(col),record):val}renderItem(record){const{allowAddItem,allowDeletes,expandFieldset,tableColumns}=this.props,isExpanded=!!this.state.expandedColumns[record.id]||record.__expanded;let tds=[];expandFieldset&&tds.push((0,emotion_react_browser_esm.tZ)("td",{key:"__expand",className:"expand"},(0,emotion_react_browser_esm.tZ)("i",{role:"button","aria-label":"Toggle expand",tabIndex:0,className:`fa fa-caret-${isExpanded?"down":"right"} text-primary pointer`,onClick:this.toggleExpand.bind(this,record.id)}))),tds=tds.concat(tableColumns.map((col=>(0,emotion_react_browser_esm.tZ)("td",(0,esm_extends.Z)({},this.getCellProps(record,col),{key:col}),this.renderCell(record,col))))),allowAddItem&&tds.push((0,emotion_react_browser_esm.tZ)("td",{key:"add"})),allowDeletes&&tds.push((0,emotion_react_browser_esm.tZ)("td",{key:"__actions",className:"text-primary"},(0,emotion_react_browser_esm.tZ)(Icons.Z.Trash,{"aria-label":"Delete item",className:"pointer",role:"button",tabIndex:0,onClick:this.deleteItem.bind(this,record.id)})));const trs=[(0,emotion_react_browser_esm.tZ)("tr",{"data-test":"table-row",className:"row",key:record.id},tds)];return isExpanded&&trs.push((0,emotion_react_browser_esm.tZ)("tr",{className:"exp",key:`exp__${record.id}`},(0,emotion_react_browser_esm.tZ)("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},(0,emotion_react_browser_esm.tZ)("div",null,this.renderExpandableSection(record))))),trs}renderEmptyCell(){return(0,emotion_react_browser_esm.tZ)("tr",null,(0,emotion_react_browser_esm.tZ)("td",{className:"empty-collection"},this.props.emptyMessage))}renderTableBody(){const data=this.state.collectionArray,content=data.length?data.map((d=>this.renderItem(d))):this.renderEmptyCell();return(0,emotion_react_browser_esm.tZ)("tbody",null,content)}render(){return(0,emotion_react_browser_esm.tZ)(react.Fragment,null,(0,emotion_react_browser_esm.tZ)(CrudButtonWrapper,null,this.props.allowAddItem&&(0,emotion_react_browser_esm.tZ)(StyledButtonWrapper,null,(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",buttonStyle:"tertiary",onClick:this.onAddItem},(0,emotion_react_browser_esm.tZ)("i",{className:"fa fa-plus"})," ",(0,TranslatorSingleton.t)("Add item")))),(0,emotion_react_browser_esm.tZ)(CrudTableWrapper,{className:"CRUD",stickyHeader:this.props.stickyHeader},(0,emotion_react_browser_esm.tZ)("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody())))}}try{CollectionTable.displayName="CollectionTable",CollectionTable.__docgenInfo={description:"",displayName:"CollectionTable",props:{allowAddItem:{defaultValue:null,description:"",name:"allowAddItem",required:!1,type:{name:"boolean"}},allowDeletes:{defaultValue:null,description:"",name:"allowDeletes",required:!1,type:{name:"boolean"}},collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"object[]"}},columnLabels:{defaultValue:null,description:"",name:"columnLabels",required:!1,type:{name:"object"}},columnLabelTooltips:{defaultValue:null,description:"",name:"columnLabelTooltips",required:!1,type:{name:"object"}},emptyMessage:{defaultValue:null,description:"",name:"emptyMessage",required:!1,type:{name:"ReactNode"}},expandFieldset:{defaultValue:null,description:"",name:"expandFieldset",required:!1,type:{name:"ReactNode"}},extraButtons:{defaultValue:null,description:"",name:"extraButtons",required:!1,type:{name:"ReactNode"}},itemGenerator:{defaultValue:null,description:"",name:"itemGenerator",required:!1,type:{name:"(() => any)"}},itemCellProps:{defaultValue:null,description:"",name:"itemCellProps",required:!1,type:{name:"((val: unknown, label: string, record: any) => DetailedHTMLProps<TdHTMLAttributes<HTMLTableCellElement>, HTMLTableCellElement>)[]"}},itemRenderers:{defaultValue:null,description:"",name:"itemRenderers",required:!1,type:{name:"((val: unknown, onChange: () => void, label: string, record: any) => ReactNode)[]"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((arg0: any) => void)"}},tableColumns:{defaultValue:null,description:"",name:"tableColumns",required:!0,type:{name:"any[]"}},sortColumns:{defaultValue:null,description:"",name:"sortColumns",required:!0,type:{name:"string[]"}},stickyHeader:{defaultValue:null,description:"",name:"stickyHeader",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Datasource/CollectionTable.tsx#CollectionTable"]={docgenInfo:CollectionTable.__docgenInfo,name:"CollectionTable",path:"src/components/Datasource/CollectionTable.tsx#CollectionTable"})}catch(__react_docgen_typescript_loader_error){}const DatasourceContainer=style.iK.div`
  .change-warning {
    margin: 16px 10px 0;
    color: ${_ref=>{let{theme}=_ref;return theme.colors.warning.base}};
  }

  .change-warning .bold {
    font-weight: ${_ref2=>{let{theme}=_ref2;return theme.typography.weights.bold}};
  }

  .form-group.has-feedback > .help-block {
    margin-top: 8px;
  }

  .form-group.form-group-md {
    margin-bottom: 8px;
  }
`,FlexRowContainer=style.iK.div`
  align-items: center;
  display: flex;

  svg {
    margin-right: ${_ref3=>{let{theme}=_ref3;return theme.gridUnit}}px;
  }
`,StyledTableTabs=(0,style.iK)(Tabs.default)`
  overflow: visible;
  .ant-tabs-content-holder {
    overflow: visible;
  }
`,StyledBadge=(0,style.iK)(Badge.Z)`
  .ant-badge-count {
    line-height: ${_ref4=>{let{theme}=_ref4;return 4*theme.gridUnit}}px;
    height: ${_ref5=>{let{theme}=_ref5;return 4*theme.gridUnit}}px;
    margin-left: ${_ref6=>{let{theme}=_ref6;return theme.gridUnit}}px;
  }
`,EditLockContainer=style.iK.div`
  font-size: ${_ref7=>{let{theme}=_ref7;return theme.typography.sizes.s}}px;
  display: flex;
  align-items: center;
  a {
    padding: 0 10px;
  }
`,ColumnButtonWrapper=style.iK.div`
  text-align: right;
  ${_ref8=>{let{theme}=_ref8;return`margin-bottom: ${2*theme.gridUnit}px`}}
`,StyledLabelWrapper=style.iK.div`
  display: flex;
  align-items: center;
  span {
    margin-right: ${_ref9=>{let{theme}=_ref9;return theme.gridUnit}}px;
  }
`,StyledColumnsTabWrapper=style.iK.div`
  .table > tbody > tr > td {
    vertical-align: middle;
  }

  .ant-tag {
    margin-top: ${_ref10=>{let{theme}=_ref10;return theme.gridUnit}}px;
  }
`,DatasourceEditor_StyledButtonWrapper=style.iK.span`
  ${_ref11=>{let{theme}=_ref11;return`\n    margin-top: ${3*theme.gridUnit}px;\n    margin-left: ${3*theme.gridUnit}px;\n  `}}
`,checkboxGenerator=(d,onChange)=>(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{value:d,onChange}),DATA_TYPES=[{value:"STRING",label:(0,TranslatorSingleton.t)("STRING")},{value:"NUMERIC",label:(0,TranslatorSingleton.t)("NUMERIC")},{value:"DATETIME",label:(0,TranslatorSingleton.t)("DATETIME")},{value:"BOOLEAN",label:(0,TranslatorSingleton.t)("BOOLEAN")}],DATASOURCE_TYPES_ARR=[{key:"physical",label:(0,TranslatorSingleton.t)("Physical (table or view)")},{key:"virtual",label:(0,TranslatorSingleton.t)("Virtual (SQL)")}],DATASOURCE_TYPES={};DATASOURCE_TYPES_ARR.forEach((o=>{DATASOURCE_TYPES[o.key]=o}));var _ref13={name:"s5xdrg",styles:"display:flex;align-items:center"};function CollectionTabTitle(_ref12){let{title,collection}=_ref12;return(0,emotion_react_browser_esm.tZ)("div",{css:_ref13},title," ",(0,emotion_react_browser_esm.tZ)(StyledBadge,{count:collection?collection.length:0,showZero:!0}))}function ColumnCollectionTable(_ref14){let{columns,datasource,onColumnsChange,onDatasourceChange,editableColumnName,showExpression,allowAddItem,allowEditDataType,itemGenerator,columnLabelTooltips}=_ref14;return(0,emotion_react_browser_esm.tZ)(CRUDCollection,{tableColumns:(0,featureFlags.cr)(featureFlags.TT.ENABLE_ADVANCED_DATA_TYPES)?["column_name","advanced_data_type","type","is_dttm","main_dttm_col","filterable","groupby"]:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],sortColumns:(0,featureFlags.cr)(featureFlags.TT.ENABLE_ADVANCED_DATA_TYPES)?["column_name","advanced_data_type","type","is_dttm","main_dttm_col","filterable","groupby"]:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],allowDeletes:!0,allowAddItem,itemGenerator,collection:columns,columnLabelTooltips,stickyHeader:!0,expandFieldset:(0,emotion_react_browser_esm.tZ)(FormContainer,null,(0,emotion_react_browser_esm.tZ)(Fieldset,{compact:!0},showExpression&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"expression",label:(0,TranslatorSingleton.t)("SQL expression"),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{language:"markdown",offerEditInModal:!1,resize:"vertical"})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"verbose_name",label:(0,TranslatorSingleton.t)("Label"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"verbose_name",placeholder:(0,TranslatorSingleton.t)("Label")})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"description",label:(0,TranslatorSingleton.t)("Description"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"description",placeholder:(0,TranslatorSingleton.t)("Description")})}),allowEditDataType&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"type",label:(0,TranslatorSingleton.t)("Data type"),control:(0,emotion_react_browser_esm.tZ)(components.Ph,{ariaLabel:(0,TranslatorSingleton.t)("Data type"),options:DATA_TYPES,name:"type",allowNewOptions:!0,allowClear:!0})}),(0,featureFlags.cr)(featureFlags.TT.ENABLE_ADVANCED_DATA_TYPES)?(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"advanced_data_type",label:(0,TranslatorSingleton.t)("Advanced data type"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"advanced_data_type",placeholder:(0,TranslatorSingleton.t)("Advanced Data type")})}):(0,emotion_react_browser_esm.tZ)(react.Fragment,null),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"python_date_format",label:(0,TranslatorSingleton.t)("Datetime format"),description:(0,emotion_react_browser_esm.tZ)("div",null,(0,TranslatorSingleton.t)("The pattern of timestamp format. For strings use "),(0,emotion_react_browser_esm.tZ)("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},(0,TranslatorSingleton.t)("Python datetime string pattern")),(0,TranslatorSingleton.t)(" expression which needs to adhere to the "),(0,emotion_react_browser_esm.tZ)("a",{href:"https://en.wikipedia.org/wiki/ISO_8601"},(0,TranslatorSingleton.t)("ISO 8601")),(0,TranslatorSingleton.t)(" standard to ensure that the lexicographical ordering\n                      coincides with the chronological ordering. If the\n                      timestamp format does not adhere to the ISO 8601 standard\n                      you will need to define an expression and type for\n                      transforming the string into a date or timestamp. Note\n                      currently time zones are not supported. If time is stored\n                      in epoch format, put `epoch_s` or `epoch_ms`. If no pattern\n                      is specified we fall back to using the optional defaults on a per\n                      database/column name level via the extra parameter.")),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"python_date_format",placeholder:"%Y/%m/%d"})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"certified_by",label:(0,TranslatorSingleton.t)("Certified By"),description:(0,TranslatorSingleton.t)("Person or group that has certified this metric"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"certified",placeholder:(0,TranslatorSingleton.t)("Certified by")})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"certification_details",label:(0,TranslatorSingleton.t)("Certification details"),description:(0,TranslatorSingleton.t)("Details of the certification"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"certificationDetails",placeholder:(0,TranslatorSingleton.t)("Certification details")})}))),columnLabels:(0,featureFlags.cr)(featureFlags.TT.ENABLE_ADVANCED_DATA_TYPES)?{column_name:(0,TranslatorSingleton.t)("Column"),advanced_data_type:(0,TranslatorSingleton.t)("Advanced data type"),type:(0,TranslatorSingleton.t)("Data type"),groupby:(0,TranslatorSingleton.t)("Is dimension"),is_dttm:(0,TranslatorSingleton.t)("Is temporal"),main_dttm_col:(0,TranslatorSingleton.t)("Default datetime"),filterable:(0,TranslatorSingleton.t)("Is filterable")}:{column_name:(0,TranslatorSingleton.t)("Column"),type:(0,TranslatorSingleton.t)("Data type"),groupby:(0,TranslatorSingleton.t)("Is dimension"),is_dttm:(0,TranslatorSingleton.t)("Is temporal"),main_dttm_col:(0,TranslatorSingleton.t)("Default datetime"),filterable:(0,TranslatorSingleton.t)("Is filterable")},onChange:onColumnsChange,itemRenderers:(0,featureFlags.cr)(featureFlags.TT.ENABLE_ADVANCED_DATA_TYPES)?{column_name:(v,onItemChange,_,record)=>editableColumnName?(0,emotion_react_browser_esm.tZ)(StyledLabelWrapper,null,record.is_certified&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:record.certified_by,details:record.certification_details}),(0,emotion_react_browser_esm.tZ)(EditableTitle.Z,{canEdit:!0,title:v,onSaveTitle:onItemChange})):(0,emotion_react_browser_esm.tZ)(StyledLabelWrapper,null,record.is_certified&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:record.certified_by,details:record.certification_details}),v),main_dttm_col:(value,_onItemChange,_label,record)=>{const checked=datasource.main_dttm_col===record.column_name,disabled=!columns.find((column=>column.column_name===record.column_name)).is_dttm;return(0,emotion_react_browser_esm.tZ)(Radio.Y,{checked,disabled,onChange:()=>onDatasourceChange({...datasource,main_dttm_col:record.column_name})})},type:d=>d?(0,emotion_react_browser_esm.tZ)(Label.Z,null,d):null,advanced_data_type:d=>(0,emotion_react_browser_esm.tZ)(Label.Z,{onChange:onColumnsChange},d),is_dttm:checkboxGenerator,filterable:checkboxGenerator,groupby:checkboxGenerator}:{column_name:(v,onItemChange,_,record)=>editableColumnName?(0,emotion_react_browser_esm.tZ)(StyledLabelWrapper,null,record.is_certified&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:record.certified_by,details:record.certification_details}),(0,emotion_react_browser_esm.tZ)(TextControl.Z,{value:v,onChange:onItemChange})):(0,emotion_react_browser_esm.tZ)(StyledLabelWrapper,null,record.is_certified&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:record.certified_by,details:record.certification_details}),v),main_dttm_col:(value,_onItemChange,_label,record)=>{const checked=datasource.main_dttm_col===record.column_name,disabled=!columns.find((column=>column.column_name===record.column_name)).is_dttm;return(0,emotion_react_browser_esm.tZ)(Radio.Y,{checked,disabled,onChange:()=>onDatasourceChange({...datasource,main_dttm_col:record.column_name})})},type:d=>d?(0,emotion_react_browser_esm.tZ)(Label.Z,null,d):null,is_dttm:checkboxGenerator,filterable:checkboxGenerator,groupby:checkboxGenerator}})}function StackedField(_ref15){let{label,formElement}=_ref15;return(0,emotion_react_browser_esm.tZ)("div",null,(0,emotion_react_browser_esm.tZ)("div",null,(0,emotion_react_browser_esm.tZ)("strong",null,label)),(0,emotion_react_browser_esm.tZ)("div",null,formElement))}function FormContainer(_ref16){let{children}=_ref16;return(0,emotion_react_browser_esm.tZ)(Card.Z,{padded:!0},children)}CollectionTabTitle.propTypes={title:prop_types_default().string,collection:prop_types_default().array},ColumnCollectionTable.propTypes={columns:prop_types_default().array.isRequired,datasource:prop_types_default().object.isRequired,onColumnsChange:prop_types_default().func.isRequired,onDatasourceChange:prop_types_default().func.isRequired,editableColumnName:prop_types_default().bool,showExpression:prop_types_default().bool,allowAddItem:prop_types_default().bool,allowEditDataType:prop_types_default().bool,itemGenerator:prop_types_default().func},ColumnCollectionTable.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:()=>({column_name:(0,TranslatorSingleton.t)("<new column>"),filterable:!0,groupby:!0})},StackedField.propTypes={label:prop_types_default().string,formElement:prop_types_default().node},FormContainer.propTypes={children:prop_types_default().node};const propTypes={datasource:prop_types_default().object.isRequired,onChange:prop_types_default().func,addSuccessToast:prop_types_default().func.isRequired,addDangerToast:prop_types_default().func.isRequired,setIsEditing:prop_types_default().func};function OwnersSelector(_ref17){let{datasource,onChange}=_ref17;const loadOptions=(0,react.useCallback)((function(search,page,pageSize){void 0===search&&(search="");const query=rison_default().encode({filter:search,page,page_size:pageSize});return SupersetClient.Z.get({endpoint:`/api/v1/dataset/related/owners?q=${query}`}).then((response=>({data:response.json.result.filter((item=>item.extra.active)).map((item=>({value:item.value,label:item.text}))),totalCount:response.json.count})))}),[]);return(0,emotion_react_browser_esm.tZ)(components.qb,{ariaLabel:(0,TranslatorSingleton.t)("Select owners"),mode:"multiple",name:"owners",value:datasource.owners,options:loadOptions,onChange,header:(0,emotion_react_browser_esm.tZ)(Form.lX,null,(0,TranslatorSingleton.t)("Owners")),allowClear:!0})}var _ref23={name:"hkh81z",styles:"margin-top:8px"},_ref24={name:"hkh81z",styles:"margin-top:8px"};class DatasourceEditor extends react.PureComponent{constructor(props){var _props$datasource$met;super(props),this.state={datasource:{...props.datasource,owners:props.datasource.owners.map((owner=>({value:owner.value||owner.id,label:owner.label||`${owner.first_name} ${owner.last_name}`}))),metrics:null==(_props$datasource$met=props.datasource.metrics)?void 0:_props$datasource$met.map((metric=>{const{certified_by:certifiedByMetric,certification_details:certificationDetails}=metric,{certification:{details,certified_by:certifiedBy}={},warning_markdown:warningMarkdown}=JSON.parse(metric.extra||"{}")||{};return{...metric,certification_details:certificationDetails||details,warning_markdown:warningMarkdown||"",certified_by:certifiedBy||certifiedByMetric}}))},errors:[],isSqla:"table"===props.datasource.datasource_type||"table"===props.datasource.type,isEditMode:!1,databaseColumns:props.datasource.columns.filter((col=>!col.expression)),calculatedColumns:props.datasource.columns.filter((col=>!!col.expression)),metadataLoading:!1,activeTabKey:0,datasourceType:props.datasource.sql?DATASOURCE_TYPES.virtual.key:DATASOURCE_TYPES.physical.key},this.onChange=this.onChange.bind(this),this.onChangeEditMode=this.onChangeEditMode.bind(this),this.onDatasourcePropChange=this.onDatasourcePropChange.bind(this),this.onDatasourceChange=this.onDatasourceChange.bind(this),this.tableChangeAndSyncMetadata=this.tableChangeAndSyncMetadata.bind(this),this.syncMetadata=this.syncMetadata.bind(this),this.setColumns=this.setColumns.bind(this),this.validateAndChange=this.validateAndChange.bind(this),this.handleTabSelect=this.handleTabSelect.bind(this),this.allowEditSource=!(0,featureFlags.cr)(featureFlags.TT.DISABLE_DATASET_SOURCE_EDIT),this.currencies=(0,ensureIsArray.Z)(props.currencies).map((currencyCode=>({value:currencyCode,label:`${(0,CurrencyFormatter.j)({symbol:currencyCode})} (${currencyCode})`})))}onChange(){const{datasourceType,datasource}=this.state,sql=datasourceType===DATASOURCE_TYPES.physical.key?"":datasource.sql,newDatasource={...this.state.datasource,sql,columns:[...this.state.databaseColumns,...this.state.calculatedColumns]};this.props.onChange(newDatasource,this.state.errors)}onChangeEditMode(){this.props.setIsEditing(!this.state.isEditMode),this.setState((prevState=>({isEditMode:!prevState.isEditMode})))}onDatasourceChange(datasource,callback){void 0===callback&&(callback=this.validateAndChange),this.setState({datasource},callback)}onDatasourcePropChange(attr,value){if(void 0===value)return;const datasource={...this.state.datasource,[attr]:value};this.setState((prevState=>({datasource:{...prevState.datasource,[attr]:value}})),"table_name"===attr?this.onDatasourceChange(datasource,this.tableChangeAndSyncMetadata):this.onDatasourceChange(datasource,this.validateAndChange))}onDatasourceTypeChange(datasourceType){this.setState({datasourceType})}setColumns(obj){this.setState(obj,this.validateAndChange)}validateAndChange(){this.validate(this.onChange)}tableChangeAndSyncMetadata(){this.validate((()=>{this.syncMetadata(),this.onChange()}))}updateColumns(cols){const{databaseColumns}=this.state,databaseColumnNames=cols.map((col=>col.column_name)),currentCols=databaseColumns.reduce(((agg,col)=>({...agg,[col.column_name]:col})),{}),finalColumns=[],results={added:[],modified:[],removed:databaseColumns.map((col=>col.column_name)).filter((col=>!databaseColumnNames.includes(col)))};return cols.forEach((col=>{const currentCol=currentCols[col.column_name];currentCol?currentCol.type!==col.type||!currentCol.is_dttm&&col.is_dttm?(finalColumns.push({...currentCol,type:col.type,is_dttm:currentCol.is_dttm||col.is_dttm}),results.modified.push(col.column_name)):finalColumns.push(currentCol):(finalColumns.push({id:shortid_default().generate(),column_name:col.column_name,type:col.type,groupby:!0,filterable:!0,is_dttm:col.is_dttm}),results.added.push(col.column_name))})),(results.added.length||results.modified.length||results.removed.length)&&this.setColumns({databaseColumns:finalColumns}),results}syncMetadata(){const{datasource}=this.state,params={datasource_type:datasource.type||datasource.datasource_type,database_name:datasource.database.database_name||datasource.database.name,schema_name:datasource.schema,table_name:datasource.table_name,normalize_columns:datasource.normalize_columns,always_filter_main_dttm:datasource.always_filter_main_dttm};Object.entries(params).forEach((_ref18=>{let[key,value]=_ref18;void 0===value&&(params[key]=null)}));const endpoint=`/datasource/external_metadata_by_name/?q=${rison_default().encode_uri(params)}`;this.setState({metadataLoading:!0}),SupersetClient.Z.get({endpoint}).then((_ref19=>{let{json}=_ref19;const results=this.updateColumns(json);results.modified.length&&this.props.addSuccessToast((0,TranslatorSingleton.t)("Modified columns: %s",results.modified.join(", "))),results.removed.length&&this.props.addSuccessToast((0,TranslatorSingleton.t)("Removed columns: %s",results.removed.join(", "))),results.added.length&&this.props.addSuccessToast((0,TranslatorSingleton.t)("New columns added: %s",results.added.join(", "))),this.props.addSuccessToast((0,TranslatorSingleton.t)("Metadata has been synced")),this.setState({metadataLoading:!1})})).catch((response=>(0,getClientErrorObject.O$)(response).then((_ref20=>{let{error,statusText}=_ref20;this.props.addDangerToast(error||statusText||(0,TranslatorSingleton.t)("An error has occurred")),this.setState({metadataLoading:!1})}))))}findDuplicates(arr,accessor){const seen={},dups=[];return arr.forEach((obj=>{const item=accessor(obj);item in seen?dups.push(item):seen[item]=null})),dups}validate(callback){let dups,errors=[];const{datasource}=this.state;dups=this.findDuplicates(datasource.columns,(obj=>obj.column_name)),errors=errors.concat(dups.map((name=>(0,TranslatorSingleton.t)("Column name [%s] is duplicated",name)))),dups=this.findDuplicates(datasource.metrics,(obj=>obj.metric_name)),errors=errors.concat(dups.map((name=>(0,TranslatorSingleton.t)("Metric name [%s] is duplicated",name))));const noFilterCalcCols=this.state.calculatedColumns.filter((col=>!col.expression&&!col.json));errors=errors.concat(noFilterCalcCols.map((col=>(0,TranslatorSingleton.t)("Calculated column [%s] requires an expression",col.column_name))));try{var _this$state$datasourc;null==(_this$state$datasourc=this.state.datasource.metrics)||_this$state$datasourc.forEach((metric=>{var _metric$currency;return(null==(_metric$currency=metric.currency)?void 0:_metric$currency.symbol)&&new Intl.NumberFormat("en-US",{style:"currency",currency:metric.currency.symbol})}))}catch{errors=errors.concat([(0,TranslatorSingleton.t)("Invalid currency code in saved metrics")])}this.setState({errors},callback)}handleTabSelect(activeTabKey){this.setState({activeTabKey})}sortMetrics(metrics){return metrics.sort(((_ref21,_ref22)=>{let{id:a}=_ref21,{id:b}=_ref22;return b-a}))}renderSettingsFieldset(){const{datasource}=this.state;return(0,emotion_react_browser_esm.tZ)(Fieldset,{title:(0,TranslatorSingleton.t)("Basic"),item:datasource,onChange:this.onDatasourceChange},(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"description",label:(0,TranslatorSingleton.t)("Description"),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{language:"markdown",offerEditInModal:!1,resize:"vertical"})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"default_endpoint",label:(0,TranslatorSingleton.t)("Default URL"),description:(0,TranslatorSingleton.t)("Default URL to redirect to when accessing from the dataset list page"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"default_endpoint"})}),(0,emotion_react_browser_esm.tZ)(Field,{inline:!0,fieldKey:"filter_select_enabled",label:(0,TranslatorSingleton.t)("Autocomplete filters"),description:(0,TranslatorSingleton.t)("Whether to populate autocomplete filters options"),control:(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,null)}),this.state.isSqla&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"fetch_values_predicate",label:(0,TranslatorSingleton.t)("Autocomplete query predicate"),description:(0,TranslatorSingleton.t)('When using "Autocomplete filters", this can be used to improve performance of the query fetching the values. Use this option to apply a predicate (WHERE clause) to the query selecting the distinct values from the table. Typically the intent would be to limit the scan by applying a relative time filter on a partitioned or indexed time-related field.'),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{language:"sql",controlId:"fetch_values_predicate",minLines:5,resize:"vertical"})}),this.state.isSqla&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"extra",label:(0,TranslatorSingleton.t)("Extra"),description:(0,TranslatorSingleton.t)('Extra data to specify table metadata. Currently supports metadata of the format: `{ "certification": { "certified_by": "Data Platform Team", "details": "This table is the source of truth." }, "warning_markdown": "This is a warning." }`.'),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{controlId:"extra",language:"json",offerEditInModal:!1,resize:"vertical"})}),(0,emotion_react_browser_esm.tZ)(OwnersSelector,{datasource,onChange:newOwners=>{this.onDatasourceChange({...datasource,owners:newOwners})}}))}renderAdvancedFieldset(){const{datasource}=this.state;return(0,emotion_react_browser_esm.tZ)(Fieldset,{title:(0,TranslatorSingleton.t)("Advanced"),item:datasource,onChange:this.onDatasourceChange},(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"cache_timeout",label:(0,TranslatorSingleton.t)("Cache timeout"),description:(0,TranslatorSingleton.t)("The duration of time in seconds before the cache is invalidated. Set to -1 to bypass the cache."),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"cache_timeout"})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"offset",label:(0,TranslatorSingleton.t)("Hours offset"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"offset"}),description:(0,TranslatorSingleton.t)("The number of hours, negative or positive, to shift the time column. This can be used to move UTC time to local time.")}),this.state.isSqla&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"template_params",label:(0,TranslatorSingleton.t)("Template parameters"),description:(0,TranslatorSingleton.t)("A set of parameters that become available in the query using Jinja templating syntax"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"template_params"})}),(0,emotion_react_browser_esm.tZ)(Field,{inline:!0,fieldKey:"normalize_columns",label:(0,TranslatorSingleton.t)("Normalize column names"),description:(0,TranslatorSingleton.t)("Allow column names to be changed to case insensitive format, if supported (e.g. Oracle, Snowflake)."),control:(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{controlId:"normalize_columns"})}),(0,emotion_react_browser_esm.tZ)(Field,{inline:!0,fieldKey:"always_filter_main_dttm",label:(0,TranslatorSingleton.t)("Always filter main datetime column"),description:(0,TranslatorSingleton.t)("When the secondary temporal columns are filtered, apply the same filter to the main datetime column."),control:(0,emotion_react_browser_esm.tZ)(CheckboxControl.Z,{controlId:"always_filter_main_dttm"})}))}renderSpatialTab(){const{datasource}=this.state,{spatials,all_cols:allCols}=datasource;return(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{tab:(0,emotion_react_browser_esm.tZ)(CollectionTabTitle,{collection:spatials,title:(0,TranslatorSingleton.t)("Spatial")}),key:4},(0,emotion_react_browser_esm.tZ)(CRUDCollection,{tableColumns:["name","config"],onChange:this.onDatasourcePropChange.bind(this,"spatials"),itemGenerator:()=>({name:(0,TranslatorSingleton.t)("<new spatial>"),type:(0,TranslatorSingleton.t)("<no type>"),config:null}),collection:spatials,allowDeletes:!0,itemRenderers:{name:(d,onChange)=>(0,emotion_react_browser_esm.tZ)(EditableTitle.Z,{canEdit:!0,title:d,onSaveTitle:onChange}),config:(v,onChange)=>(0,emotion_react_browser_esm.tZ)(SpatialControl.Z,{value:v,onChange,choices:allCols})}}))}renderSourceFieldset(theme){var _datasource$database,_datasource$database2,_datasource$database3;const{datasource}=this.state;return(0,emotion_react_browser_esm.tZ)("div",null,this.allowEditSource&&(0,emotion_react_browser_esm.tZ)(EditLockContainer,null,(0,emotion_react_browser_esm.tZ)("span",{role:"button",tabIndex:0,onClick:this.onChangeEditMode},this.state.isEditMode?(0,emotion_react_browser_esm.tZ)(Icons.Z.LockUnlocked,{iconColor:theme.colors.grayscale.base}):(0,emotion_react_browser_esm.tZ)(Icons.Z.LockLocked,{iconColor:theme.colors.grayscale.base})),!this.state.isEditMode&&(0,emotion_react_browser_esm.tZ)("div",null,(0,TranslatorSingleton.t)("Click the lock to make changes.")),this.state.isEditMode&&(0,emotion_react_browser_esm.tZ)("div",null,(0,TranslatorSingleton.t)("Click the lock to prevent further changes."))),(0,emotion_react_browser_esm.tZ)("div",{className:"m-l-10 m-t-20 m-b-10"},DATASOURCE_TYPES_ARR.map((type=>(0,emotion_react_browser_esm.tZ)(Radio.Y,{key:type.key,value:type.key,inline:!0,onChange:this.onDatasourceTypeChange.bind(this,type.key),checked:this.state.datasourceType===type.key,disabled:!this.state.isEditMode},type.label)))),(0,emotion_react_browser_esm.tZ)("hr",null),(0,emotion_react_browser_esm.tZ)(Fieldset,{item:datasource,onChange:this.onDatasourceChange,compact:!0},this.state.datasourceType===DATASOURCE_TYPES.virtual.key&&(0,emotion_react_browser_esm.tZ)("div",null,this.state.isSqla&&(0,emotion_react_browser_esm.tZ)(react.Fragment,null,(0,emotion_react_browser_esm.tZ)(components.JX,{xs:24,md:12},(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"databaseSelector",label:(0,TranslatorSingleton.t)("virtual"),control:(0,emotion_react_browser_esm.tZ)("div",{css:_ref23},(0,emotion_react_browser_esm.tZ)(DatabaseSelector,{db:null==datasource?void 0:datasource.database,schema:datasource.schema,onSchemaChange:schema=>this.state.isEditMode&&this.onDatasourcePropChange("schema",schema),onDbChange:database=>this.state.isEditMode&&this.onDatasourcePropChange("database",database),formMode:!1,handleError:this.props.addDangerToast,readOnly:!this.state.isEditMode}))}),(0,emotion_react_browser_esm.tZ)("div",{css:(0,emotion_react_browser_esm.iv)({width:"calc(100% - 34px)",marginTop:-16},"","")},(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"table_name",label:(0,TranslatorSingleton.t)("Name"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"table_name",onChange:table=>{this.onDatasourcePropChange("table_name",table)},placeholder:(0,TranslatorSingleton.t)("Dataset name"),disabled:!this.state.isEditMode})}))),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"sql",label:(0,TranslatorSingleton.t)("SQL"),description:(0,TranslatorSingleton.t)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{language:"sql",offerEditInModal:!1,minLines:20,maxLines:1/0,readOnly:!this.state.isEditMode,resize:"both"})}))),this.state.datasourceType===DATASOURCE_TYPES.physical.key&&(0,emotion_react_browser_esm.tZ)(components.JX,{xs:24,md:12},this.state.isSqla&&(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"tableSelector",label:(0,TranslatorSingleton.t)("Physical"),control:(0,emotion_react_browser_esm.tZ)("div",{css:_ref24},(0,emotion_react_browser_esm.tZ)(components_TableSelector,{clearable:!1,database:{...datasource.database,database_name:(null==(_datasource$database=datasource.database)?void 0:_datasource$database.database_name)||(null==(_datasource$database2=datasource.database)?void 0:_datasource$database2.name)},dbId:null==(_datasource$database3=datasource.database)?void 0:_datasource$database3.id,handleError:this.props.addDangerToast,schema:datasource.schema,sqlLabMode:!1,tableValue:datasource.table_name,onSchemaChange:this.state.isEditMode?schema=>this.onDatasourcePropChange("schema",schema):void 0,onDbChange:this.state.isEditMode?database=>this.onDatasourcePropChange("database",database):void 0,onTableSelectChange:this.state.isEditMode?table=>this.onDatasourcePropChange("table_name",table):void 0,readOnly:!this.state.isEditMode})),description:(0,TranslatorSingleton.t)("The pointer to a physical table (or view). Keep in mind that the chart is associated to this Superset logical table, and this logical table points the physical table referenced here.")}))))}renderErrors(){return this.state.errors.length>0?(0,emotion_react_browser_esm.tZ)(Alert.Z,{css:theme=>({marginBottom:4*theme.gridUnit}),type:"error",message:(0,emotion_react_browser_esm.tZ)(react.Fragment,null,this.state.errors.map((err=>(0,emotion_react_browser_esm.tZ)("div",{key:err},err))))}):null}renderMetricCollection(){const{datasource}=this.state,{metrics}=datasource,sortedMetrics=null!=metrics&&metrics.length?this.sortMetrics(metrics):[];return(0,emotion_react_browser_esm.tZ)(CRUDCollection,{tableColumns:["metric_name","verbose_name","expression"],sortColumns:["metric_name","verbose_name","expression"],columnLabels:{metric_name:(0,TranslatorSingleton.t)("Metric Key"),verbose_name:(0,TranslatorSingleton.t)("Label"),expression:(0,TranslatorSingleton.t)("SQL expression")},columnLabelTooltips:{metric_name:(0,TranslatorSingleton.t)("This field is used as a unique identifier to attach the metric to charts. It is also used as the alias in the SQL query.")},expandFieldset:(0,emotion_react_browser_esm.tZ)(FormContainer,null,(0,emotion_react_browser_esm.tZ)(Fieldset,{compact:!0},(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"description",label:(0,TranslatorSingleton.t)("Description"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"description",placeholder:(0,TranslatorSingleton.t)("Description")})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"d3format",label:(0,TranslatorSingleton.t)("D3 format"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"d3format",placeholder:"%y/%m/%d"})}),(0,emotion_react_browser_esm.tZ)(Field,{fieldKey:"currency",label:(0,TranslatorSingleton.t)("Metric currency"),control:(0,emotion_react_browser_esm.tZ)(CurrencyControl.Z,{currencySelectOverrideProps:{placeholder:(0,TranslatorSingleton.t)("Select or type currency symbol")},symbolSelectAdditionalStyles:emotion_react_browser_esm.iv`
                      max-width: 30%;
                    `})}),(0,emotion_react_browser_esm.tZ)(Field,{label:(0,TranslatorSingleton.t)("Certified by"),fieldKey:"certified_by",description:(0,TranslatorSingleton.t)("Person or group that has certified this metric"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"certified_by",placeholder:(0,TranslatorSingleton.t)("Certified by")})}),(0,emotion_react_browser_esm.tZ)(Field,{label:(0,TranslatorSingleton.t)("Certification details"),fieldKey:"certification_details",description:(0,TranslatorSingleton.t)("Details of the certification"),control:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{controlId:"certification_details",placeholder:(0,TranslatorSingleton.t)("Certification details")})}),(0,emotion_react_browser_esm.tZ)(Field,{label:(0,TranslatorSingleton.t)("Warning"),fieldKey:"warning_markdown",description:(0,TranslatorSingleton.t)("Optional warning about use of this metric"),control:(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{controlId:"warning_markdown",language:"markdown",offerEditInModal:!1,resize:"vertical"})}))),collection:sortedMetrics,allowAddItem:!0,onChange:this.onDatasourcePropChange.bind(this,"metrics"),itemGenerator:()=>({metric_name:(0,TranslatorSingleton.t)("<new metric>"),verbose_name:"",expression:""}),itemCellProps:{expression:()=>({width:"240px"})},itemRenderers:{metric_name:(v,onChange,_,record)=>(0,emotion_react_browser_esm.tZ)(FlexRowContainer,null,record.is_certified&&(0,emotion_react_browser_esm.tZ)(CertifiedBadge.Z,{certifiedBy:record.certified_by,details:record.certification_details}),record.warning_markdown&&(0,emotion_react_browser_esm.tZ)(WarningIconWithTooltip.Z,{warningMarkdown:record.warning_markdown}),(0,emotion_react_browser_esm.tZ)(EditableTitle.Z,{canEdit:!0,title:v,onSaveTitle:onChange})),verbose_name:(v,onChange)=>(0,emotion_react_browser_esm.tZ)(TextControl.Z,{canEdit:!0,value:v,onChange}),expression:(v,onChange)=>(0,emotion_react_browser_esm.tZ)(TextAreaControl.Z,{canEdit:!0,initialValue:v,onChange,extraClasses:["datasource-sql-expression"],language:"sql",offerEditInModal:!1,minLines:5,textAreaStyles:{minWidth:"200px",maxWidth:"450px"},resize:"both"}),description:(v,onChange,label)=>(0,emotion_react_browser_esm.tZ)(StackedField,{label,formElement:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{value:v,onChange})}),d3format:(v,onChange,label)=>(0,emotion_react_browser_esm.tZ)(StackedField,{label,formElement:(0,emotion_react_browser_esm.tZ)(TextControl.Z,{value:v,onChange})})},allowDeletes:!0,stickyHeader:!0})}render(){const{datasource,activeTabKey}=this.state,{metrics}=datasource,sortedMetrics=null!=metrics&&metrics.length?this.sortMetrics(metrics):[],{theme}=this.props;return(0,emotion_react_browser_esm.tZ)(DatasourceContainer,null,this.renderErrors(),(0,emotion_react_browser_esm.tZ)(Alert.Z,{css:theme=>({marginBottom:4*theme.gridUnit}),type:"warning",message:(0,emotion_react_browser_esm.tZ)(react.Fragment,null," ",(0,emotion_react_browser_esm.tZ)("strong",null,(0,TranslatorSingleton.t)("Be careful.")," "),(0,TranslatorSingleton.t)("Changing these settings will affect all charts using this dataset, including charts owned by other people."))}),(0,emotion_react_browser_esm.tZ)(StyledTableTabs,{fullWidth:!1,id:"table-tabs",onChange:this.handleTabSelect,defaultActiveKey:activeTabKey},(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{key:0,tab:(0,TranslatorSingleton.t)("Source")},this.renderSourceFieldset(theme)),(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{tab:(0,emotion_react_browser_esm.tZ)(CollectionTabTitle,{collection:sortedMetrics,title:(0,TranslatorSingleton.t)("Metrics")}),key:1},this.renderMetricCollection()),(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{tab:(0,emotion_react_browser_esm.tZ)(CollectionTabTitle,{collection:this.state.databaseColumns,title:(0,TranslatorSingleton.t)("Columns")}),key:2},(0,emotion_react_browser_esm.tZ)(StyledColumnsTabWrapper,null,(0,emotion_react_browser_esm.tZ)(ColumnButtonWrapper,null,(0,emotion_react_browser_esm.tZ)(DatasourceEditor_StyledButtonWrapper,null,(0,emotion_react_browser_esm.tZ)(Button.Z,{buttonSize:"small",buttonStyle:"tertiary",onClick:this.syncMetadata,className:"sync-from-source",disabled:this.state.isEditMode},(0,emotion_react_browser_esm.tZ)("i",{className:"fa fa-database"})," ",(0,TranslatorSingleton.t)("Sync columns from source")))),(0,emotion_react_browser_esm.tZ)(ColumnCollectionTable,{className:"columns-table",columns:this.state.databaseColumns,datasource,onColumnsChange:databaseColumns=>this.setColumns({databaseColumns}),onDatasourceChange:this.onDatasourceChange}),this.state.metadataLoading&&(0,emotion_react_browser_esm.tZ)(Loading.Z,null))),(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{tab:(0,emotion_react_browser_esm.tZ)(CollectionTabTitle,{collection:this.state.calculatedColumns,title:(0,TranslatorSingleton.t)("Calculated columns")}),key:3},(0,emotion_react_browser_esm.tZ)(StyledColumnsTabWrapper,null,(0,emotion_react_browser_esm.tZ)(ColumnCollectionTable,{columns:this.state.calculatedColumns,onColumnsChange:calculatedColumns=>this.setColumns({calculatedColumns}),columnLabelTooltips:{column_name:(0,TranslatorSingleton.t)("This field is used as a unique identifier to attach the calculated dimension to charts. It is also used as the alias in the SQL query.")},onDatasourceChange:this.onDatasourceChange,datasource,editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:()=>({column_name:(0,TranslatorSingleton.t)("<new column>"),filterable:!0,groupby:!0,expression:(0,TranslatorSingleton.t)("<enter SQL expression here>"),__expanded:!0})}))),(0,emotion_react_browser_esm.tZ)(Tabs.default.TabPane,{key:4,tab:(0,TranslatorSingleton.t)("Settings")},(0,emotion_react_browser_esm.tZ)(components.X2,{gutter:16},(0,emotion_react_browser_esm.tZ)(components.JX,{xs:24,md:12},(0,emotion_react_browser_esm.tZ)(FormContainer,null,this.renderSettingsFieldset())),(0,emotion_react_browser_esm.tZ)(components.JX,{xs:24,md:12},(0,emotion_react_browser_esm.tZ)(FormContainer,null,this.renderAdvancedFieldset()))))))}}DatasourceEditor.defaultProps={onChange:()=>{},setIsEditing:()=>{}},DatasourceEditor.propTypes=propTypes;const DataSourceComponent=(0,emotion_element_99289b21_browser_esm.b)(DatasourceEditor),Datasource_DatasourceEditor=(0,withToasts.ZP)(DataSourceComponent)}}]);
//# sourceMappingURL=9410.2c6d4cb4.iframe.bundle.js.map